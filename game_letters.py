import random
from telebot import types
import db_manager # ุงูุฑุจุท ุจุงูุฎุฒูุฉ ุงูููููุฉ

def register_handlers(bot):
    
    # ูุฎุฒู ุงููููุงุช ุงููููู (150 ูููุฉ) - ููุง ูู ุจุฏูู ุชุบููุฑ
    WORDS_DB = [
        "ุณูููู", "ููุจููุชุฑ", "ูุฏุฑุณุฉ", "ุชููุฌุฑุงู", "ุฃุณุฏ", "ููุณุทูู", "ุงูุนุฑุงู", "ูุตุฑ", "ุจุฑุชูุงู", "ุณูุงุฑุฉ",
        "ุทุงุฆุฑุฉ", "ูุชุงุจ", "ุชููุงุฒ", "ุฑูุถุงู", "ูููุฉ", "ููุฒ", "ุชูุงุญ", "ุนูุจ", "ูุงูุฌู", "ุฎูุฎ",
        "ุจุทูุฎ", "ูุฑุงููุฉ", "ูุฑุฒ", "ููููู", "ุฌูุงูุฉ", "ุงูุงูุงุณ", "ูุดูุด", "ุชูู", "ุฒูุชูู", "ุฑูุงู",
        "ุณูุฑูุง", "ูุจูุงู", "ุงูุงุฑุฏู", "ุงููููุช", "ุงูุจุญุฑูู", "ูุทุฑ", "ุงูุงูุงุฑุงุช", "ุนูุงู", "ุงูููู", "ุงููุบุฑุจ",
        "ุชููุณ", "ุงูุฌุฒุงุฆุฑ", "ููุจูุง", "ุงูุณูุฏุงู", "ุงูุตููุงู", "ุจุบุฏุงุฏ", "ุงููุฏุณ", "ุฏูุดู", "ุจูุฑูุช", "ุนูุงู",
        "ุงูููุงูุฉ", "ุงูุฏูุญุฉ", "ูุณูุท", "ุตูุนุงุก", "ุงูุฑุจุงุท", "ุชููุณ", "ุงูุฌุฒุงุฆุฑ", "ุทุฑุงุจูุณ", "ุงูุฎุฑุทูู", "ููุฑูุจู",
        "ููุฏู", "ุจุงุฑูุณ", "ุฑููุง", "ูุฏุฑูุฏ", "ุจุฑููู", "ุทูููู", "ุจููู", "ุณููู", "ููุณูู", "ูุงุดูุทู",
        "ููุฑ", "ููุฏ", "ุฐุฆุจ", "ุซุนูุจ", "ุฏุจ", "ุฒุฑุงูุฉ", "ููู", "ุญุตุงู", "ุฌูู", "ุจูุฑุฉ",
        "ุฎุฑูู", "ูุงุนุฒ", "ุงุฑูุจ", "ุณูุฌุงุจ", "ูุฑุฏ", "ุชูุณุงุญ", "ุซุนุจุงู", "ุณูุญูุงุฉ", "ุถูุฏุน", "ุนูุฑุจ",
        "ูุณุฑ", "ุตูุฑ", "ุจููุฉ", "ุญูุงูุฉ", "ุนุตููุฑ", "ุจุทุฉ", "ุฏุฌุงุฌุฉ", "ุทุงููุณ", "ุจุทุฑูู", "ูุนุงูุฉ",
        "ุทุงููุฉ", "ูุฑุณู", "ุณุฑูุฑ", "ุฏููุงุจ", "ูุงูุฐุฉ", "ุจุงุจ", "ููุชุงุญ", "ููู", "ุฏูุชุฑ", "ูุณุทุฑุฉ",
        "ููุญุงุฉ", "ุญููุจุฉ", "ุณุงุนุฉ", "ูุงุชู", "ุดุงุญู", "ุณูุงุนุฉ", "ูุงููุฑุง", "ูุฐูุงุน", "ูุตุจุงุญ", "ุซูุงุฌุฉ",
        "ูุฑู", "ููุนูุฉ", "ุดููุฉ", "ุณููู", "ุทุจู", "ููุจ", "ุงุจุฑูู", "ููุดูุฉ", "ุตุงุจูู", "ูุฑุขุฉ",
        "ููุงุจุณ", "ูููุต", "ุจูุทุงู", "ูุณุชุงู", "ุญุฐุงุก", "ุฌูุฑุจ", "ูุจุนุฉ", "ูุธุงุฑุฉ", "ุฎุงุชู", "ุณูุงุฑ",
        "ุฐูุจ", "ูุถุฉ", "ุญุฏูุฏ", "ูุญุงุณ", "ุงููุงุณ", "ุจุญุฑ", "ููุฑ", "ุฌุจู", "ุบุงุจุฉ", "ุตุญุฑุงุก",
        "ููุฑ", "ุดูุณ", "ูุฌูู", "ูููุจ", "ุณูุงุก", "ุณุญุงุจ", "ูุทุฑ", "ุซูุฌ", "ุฑุนุฏ", "ุจุฑู"
    ]

    active_games = {}

    @bot.message_handler(func=lambda m: m.text == "ููู")
    def start_game(m):
        chat_id = m.chat.id
        word = random.choice(WORDS_DB)
        
        # ุชุญููู ุงููููุฉ ุฅูู ุญุฑูู ูุฑุชุจุฉ ูุจูููุง ูุณุงูุงุช "ุง - ุณ - ุฏ"
        shuffled = " - ".join(list(word))
        
        active_games[chat_id] = word
        
        text = (
            "โโโโโโโโ โ โโโโโโโโ\n"
            "         โฏ ุชูุญูุฏู ุงููุชูุฑุชูููุจ โฏ\n"
            "โโโโโโโโ โ โโโโโโโโ\n\n"
            f"  ยป ุฌููููุน ุงูููููุฉ ุงููุชูุงููููุฉ :\n"
            f"๐ฆ [ {shuffled} ]\n\n"
            "โ๏ธ ุฃุฑุณู ุงููููุฉ ุงูุตุญูุญุฉ ุงูุขู\n"
            "๐ฐ ุงููุฌูุงุฆูุฒุฉ : 20 ุฐูุจุฉ"
        )
        bot.send_message(chat_id, text)

    @bot.message_handler(func=lambda m: m.chat.id in active_games)
    def check_answer(m):
        chat_id = m.chat.id
        # ุงูุชุฃูุฏ ูู ูุทุงุจูุฉ ุงูุญู
        if m.text.strip() == active_games[chat_id]:
            uid = m.from_user.id
            
            # ุฅุถุงูุฉ ุงูุฐูุจ ููุฎุฒูุฉ ุงูุญุฏูุฏูุฉ
            db_manager.update_user_gold(uid, 20)
            
            win_text = (
                "โฏ ุชูู ุงููุชูุญูููู ููู ุงูุฅุฌูุงุจูุฉ โฏ\n"
                "โโโโโโโโโโโโโโ\n"
                f"๐ค ุงููููุงุฆูุฒ : {m.from_user.first_name}\n"
                "โ ุงูุฅุฌูุงุจูุฉ : ุตูุญูููุญูุฉ (ููููู)\n"
                "๐ฐ ุงููุฌููุงุฆูุฒ : +20 ุฐููุจูุฉ"
            )
            bot.reply_to(m, win_text)
            del active_games[chat_id]

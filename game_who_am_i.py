import random
import db_manager

# ูุงุฆูุฉ ุงูุดุฎุตูุงุช ุงูุฅูุจุฑุงุทูุฑูุฉ ุงููุชููุนุฉ
CHARACTERS = [
    {"traits": "ุฃุญุจ ุงูุณูุฑุ ุฑูููู ุงูููุฑุ ูุฃููุช ุดุฑูู ุงูุดูุณ.. ูู ุฃูุงุ", "answer": ["ุณุงูุฑ", "ุงูุณุงูุฑ"]},
    {"traits": "ุฃูุง ูู ูุญูู ุฃุณุฑุงุฑ ุงููุตุฑุ ุฃูู ุตุงูุชุงู ูู ูุฌู ุงูุฑูุญุ ููุง ุฃูุงู ุฅูุง ูุงููุงู.. ูู ุฃูุงุ", "answer": ["ุญุงุฑุณ", "ุงูุญุงุฑุณ"]},
    {"traits": "ุฃุฌูุจ ุงูููุงููุ ุฃุทูู ุงููุณุงูุงุชุ ูุฃุญูู ุงูุฃุฎุจุงุฑ ูู ููููุฉ ุฅูู ููููุฉ.. ูู ุฃูุงุ", "answer": ["ุณุงุนู", "ุงูุณุงุนู"]},
    {"traits": "ุฃูุง ุนุฏู ุงูุฌููุ ุฌููุณู ุงููุฑูุ ูุฃุจุญุซ ุฏุงุฆูุงู ุนู ุงูุญูููุฉ ุจูู ุงูุณุทูุฑ.. ูู ุฃูุงุ", "answer": ["ุนุงูู", "ุงูุนุงูู", "ูุงุฑุฆ"]},
    {"traits": "ุฃุณูู ูู ุงูุธูุงูุ ุฃุญุจ ุงููุญุฏุฉุ ูุฃูุฑู ุงูุถุฌูุฌ.. ูู ุฃูุงุ", "answer": ["ุจููุฉ", "ุงูุจููุฉ"]},
    {"traits": "ุฃูุง ูู ูุฑูุถ ุงูุญุฏูุฏุ ุฃุตูุน ุงูุณููู ูููุฑุณุงูุ ููุงุฑู ูุง ุชูุทูุฆ.. ูู ุฃูุงุ", "answer": ["ุญุฏุงุฏ", "ุงูุญุฏุงุฏ"]},
    {"traits": "ุฃูุง ููู ุงูุตุญุฑุงุกุ ุฃุตุจุฑ ุนูู ุงูุนุทุดุ ูุฃููุฏ ุงูููุงูู ุนุจุฑ ุงูุฑูุงู.. ูู ุฃูุงุ", "answer": ["ุฌูู", "ุงูุฌูู"]},
    {"traits": "ูู ุฑูุด ููููุ ุฃููุฏ ุงูุฃุตูุงุชุ ููุง ุฃููู ุฑุฃูุงู ุฎุงุตุงู ุจู.. ูู ุฃูุงุ", "answer": ["ุจุจุบุงุก", "ุงูุจุจุบุงุก"]}
]

# ูุงุฆูุฉ ุงูุฑุฏูุฏ ุงูุฐููุฉ ุนูุฏ ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ
CORRECT_REPLIES = [
    "ุฃุญุณูุช ุงูููู.. ููุฏ ููุฐุช ุจุตูุฑุชู ุฅูู ุงูุญูููุฉุ ุฃูุง ูุนูุงู {answer}.",
    "ุฅุฌุงุจุฉ ุณุฏูุฏุฉ ูุง ูุฐุง! ูุจุฏู ุฃูู ุฎุจูุฑ ุจุงููููุณุ ุฃูุง {answer}.",
    "ูุฐูู! ููุฏ ูุดูุช ููุงุนู ุจุฐูุงุฆูุ ุฃูุง {answer}.",
    "ุฃุตุงุจ ุญุฏุณู ุนูู ุงูุญูููุฉุ ุฃูุง {answer} ููุง ุฎููุช."
]

# ูุงุฆูุฉ ุงูุฑุฏูุฏ ุนูุฏ ุงูุจุฏุก
START_REPLIES = [
    "ุญุณูุงูุ ููุชูุงุนุจ ุจุงูุนููู ููููุงู.. ุฎูู ูู ุฃูููุ",
    "ุณุฃุชููุต ุฏูุฑุงู ุฌุฏูุฏุงู ุงูุขู.. ูู ุชุณุชุทูุน ูุนุฑูุชูุ",
    "ุฅููู ูุบุฒู ุงูุฌุฏูุฏุ ุฃูุตุช ุฌูุฏุงู ูุตูุงุชู..",
    "ูู ุฌุนุจุชู ุดุฎุตูุฉ ุบุงูุถุฉุ ุญุงูู ูุดููุง.."
]

active_games = {}

def register_handlers(bot):

    @bot.message_handler(func=lambda m: m.text == "ููู")
    def start_game(m):
        char = random.choice(CHARACTERS)
        # ุชุฎุฒูู ุงูุฅุฌุงุจุงุช ุงููุญุชููุฉ ูู ูุตูููุฉ ูุฒูุงุฏุฉ ุงูุฏูุฉ
        active_games[m.chat.id] = char['answer']
        
        intro = random.choice(START_REPLIES)
        
        response = (
            "โโโโโโโโโโโโโโโโโโโ\n"
            "    ูุฑุงุณูู ุงูุชุฎููู \n"
            "โโโโโโโโโโโโโโโโโโโ\n\n"
            f"{intro}\n"
            f"๐ {char['traits']}\n\n"
            "โโโโโโโโโโโโโโโ\n"
            "ุฎูู.. ูู ุฃูููุ\n"
            "โโโโโโโโโโโโโโโ"
        )
        bot.reply_to(m, response)

    @bot.message_handler(func=lambda m: m.chat.id in active_games)
    def check_answer(m):
        correct_answers = active_games[m.chat.id]
        user_answer = m.text.strip()
        
        if user_answer in correct_answers:
            # ููุงูุฃุฉ ุนุดูุงุฆูุฉ ูุฒูุงุฏุฉ ุงูุญูุงุณ
            reward = random.randint(100, 300)
            db_manager.update_user_gold(m.from_user.id, reward)
            
            reply_template = random.choice(CORRECT_REPLIES)
            final_reply = reply_template.format(answer=user_answer)
            
            bot.reply_to(m, f"{final_reply}\n\nููุฏ ุฃุถููุช {reward} ูุทุนุฉ ุฐูุจูุฉ ูุฎุฒุงุฆูู ููุงูุฃุฉ ูุฐูุงุฆู.")
            del active_games[m.chat.id]
        
        # ุชุฌุงูู ุงูุฑุฏูุฏ ุงูุฎุงุทุฆุฉ ูุชุฑู ุงููุฌุงู ููุขุฎุฑูู ุจุงูุชุฎููู

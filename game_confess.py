import random
import db_manager
from telebot import types

def register_handlers(bot):

    # 1. Ù†Ø¸Ø§Ù… ÙƒØ±Ø³ÙŠ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ù
    CONFESS_QUESTIONS = [
        "Ù‡Ù„ ØªØ«Ù‚ Ø¨Ù†ÙØ³Ùƒ ÙØ¹Ù„Ù‹Ø§ØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ù…Ù† ÙÙ‚Ø¯Ø§Ù† Ø´Ø®Øµ Ù…Ù‚Ø±Ù‘Ø¨ØŸ", "Ù‡Ù„ Ù†Ø¯Ù…Øª ÙŠÙˆÙ…Ù‹Ø§ Ø¹Ù„Ù‰ Ù‚Ø±Ø§Ø± Ù…Ù‡Ù…ØŸ",
        "Ù‡Ù„ ØªØ­Ø¨ Ø§Ù„Ø¹Ø²Ù„Ø© Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ØŸ", "Ù‡Ù„ ØªÙ‚ÙˆÙ„ â€œØ£Ù†Ø§ Ø¨Ø®ÙŠØ±â€ ÙˆØ£Ù†Øª Ù„Ø³Øª ÙƒØ°Ù„ÙƒØŸ", "Ù‡Ù„ Ø³Ø§Ù…Ø­Øª Ø´Ø®ØµÙ‹Ø§ Ù„Ø§ ÙŠØ³ØªØ­Ù‚ØŸ",
        "Ù‡Ù„ ØªØ´ØªØ§Ù‚ Ù„Ø´Ø®Øµ Ù„Ø§ ØªØªØ­Ø¯Ø« Ù…Ø¹Ù‡ØŸ", "Ù‡Ù„ ØªØ­Ø³ Ø£Ù†Ùƒ Ù…Ø®ØªÙ„Ù Ø¹Ù† Ù…Ø­ÙŠØ·ÙƒØŸ", "Ù‡Ù„ ÙƒØªÙ…Øª Ù…Ø´Ø§Ø¹Ø±Ùƒ Ø­ØªÙ‰ ØªØ¹Ø¨ØªØŸ",
        "Ù‡Ù„ ØªØ®Ø§Ù Ù…Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ØŸ", "Ù‡Ù„ Ù…Ø±Ù‘ Ø¹Ù„ÙŠÙƒ ÙŠÙˆÙ… ØªÙ…Ù†Ù‘ÙŠØª Ù„Ùˆ ÙŠØ®ØªÙÙŠØŸ", "Ù‡Ù„ ØªØ«Ù‚ Ø¨Ø§Ù„Ù†Ø§Ø³ Ø¨Ø³Ø±Ø¹Ø©ØŸ",
        "Ù‡Ù„ ØªØ­Ø¨ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ø­ØªÙ‰ Ù„Ùˆ Ø£Ù†ÙƒØ±ØªØŸ", "Ù‡Ù„ ØªØªØ¸Ø§Ù‡Ø± Ø¨Ø§Ù„Ù‚ÙˆØ© Ø£Ù…Ø§Ù… Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†ØŸ", "Ù‡Ù„ ØªØ´Ø¹Ø± Ø£Ù†Ùƒ Ù…Ø¸Ù„ÙˆÙ… Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ØŸ",
        "Ù‡Ù„ Ù…Ø§ Ø²Ø§Ù„ Ø§Ù„Ù…Ø§Ø¶ÙŠ ÙŠØ¤Ù„Ù…ÙƒØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ø£Ù† ØªÙØ®Ø°Ù„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ØŸ", "Ù‡Ù„ ØªØ­Ø¨ Ø´Ø®ØµÙ‹Ø§ ÙˆÙ„Ø§ ÙŠØ³ØªØ·ÙŠØ¹ Ø£Ù† ÙŠØ¹Ø±ÙØŸ",
        "Ù‡Ù„ ØªÙƒØ±Ù‡ Ø§Ù„ÙˆØ¯Ø§Ø¹ØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ù…Ù† Ø§Ù„ÙˆØ­Ø¯Ø©ØŸ", "Ù‡Ù„ ØªØ¶Ø¹ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ù‚Ø¨Ù„ Ù†ÙØ³Ùƒ ØºØ§Ù„Ø¨Ù‹Ø§ØŸ",
        "Ù‡Ù„ ØªØ­Ø³ Ø£Ù†Ùƒ ØºÙŠØ± Ù…ÙÙ‡ÙˆÙ…ØŸ", "Ù‡Ù„ ØªØ®ÙÙŠ Ø¯Ù…ÙˆØ¹Ùƒ Ø¹Ù† Ø§Ù„Ø¬Ù…ÙŠØ¹ØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ø£Ù† ØªØ®Ø³Ø± Ù†ÙØ³ÙƒØŸ",
        "Ù‡Ù„ ØªØ­Ø¨ Ø§Ù„ØµÙ…Øª Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„ÙƒÙ„Ø§Ù…ØŸ", "Ù‡Ù„ ØªØ´Ø¹Ø± Ø£Ù†Ùƒ Ø£ÙƒØ¨Ø± Ù…Ù† Ø¹Ù…Ø±ÙƒØŸ", "Ù‡Ù„ Ø³Ø§Ù…Ø­Øª Ù†ÙØ³Ùƒ ÙØ¹Ù„Ù‹Ø§ØŸ",
        "Ù‡Ù„ ØªØ­Ø³ Ø£Ù†Ùƒ ØªØ­ØªØ§Ø¬ Ø¨Ø¯Ø§ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©ØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ù…Ù† Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø·ØŸ", "Ù‡Ù„ Ø¬Ø±Ø­Øª Ø´Ø®ØµÙ‹Ø§ ØªØ­Ø¨Ù‡ Ø¯ÙˆÙ† Ù‚ØµØ¯ØŸ",
        "Ù‡Ù„ ØªØ­Ø¨ Ø£Ù† ØªÙƒÙˆÙ† ÙˆØ­Ø¯Ùƒ Ù„ÙƒÙ† ØªÙƒØ±Ù‡ Ø§Ù„Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„ÙˆØ­Ø¯Ø©ØŸ", "Ù‡Ù„ ØªØ«Ù‚ Ø¨Ø´Ø®Øµ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙÙŠ Ø­ÙŠØ§ØªÙƒØŸ",
        "Ù‡Ù„ ØªØ´Ø¹Ø± Ø£Ù†Ùƒ ØªØ¹Ø·ÙŠ Ø£ÙƒØ«Ø± Ù…Ù…Ø§ ØªØ£Ø®Ø°ØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ù…Ù† Ø£Ù† ØªÙƒÙˆÙ† Ù…Ù†Ø³ÙŠÙ‹Ø§ØŸ", "Ù‡Ù„ ØªØ´Ø¹Ø± Ø£Ù† Ù‚Ù„Ø¨Ùƒ Ù…ØªØ¹Ø¨ØŸ",
        "Ù‡Ù„ ØªØ­Ø¨ Ø§Ù„Ù„ÙŠÙ„ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ù†Ù‡Ø§Ø±ØŸ", "Ù‡Ù„ ØªØ¤Ù…Ù† Ø£Ù† ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØ­Ø¯Ø« Ù„Ø³Ø¨Ø¨ØŸ", "Ù‡Ù„ Ø­Ø§ÙˆÙ„Øª Ø£Ù† ØªØªØºÙŠØ± Ù…Ù† Ø£Ø¬Ù„ Ø´Ø®ØµØŸ",
        "Ù‡Ù„ ØªÙØªÙ‚Ø¯ Ù†Ø³Ø®Ø© Ù‚Ø¯ÙŠÙ…Ø© Ù…Ù† Ù†ÙØ³ÙƒØŸ", "Ù‡Ù„ ØªØ´Ø¹Ø± Ø£Ù†Ùƒ Ù‚ÙˆÙŠ Ø±ØºÙ… ÙƒÙ„ Ø´ÙŠØ¡ØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ù…Ù† Ø£Ù† ØªÙÙÙ‡Ù… Ø®Ø·Ø£ØŸ",
        "Ù‡Ù„ ØªØ­ØªØ§Ø¬ Ù…Ù† ÙŠØ³Ù…Ø¹Ùƒ ÙÙ‚Ø·ØŸ", "Ù‡Ù„ Ù…Ø±Ø±Øª Ø¨ØªØ¬Ø±Ø¨Ø© ØºÙŠÙ‘Ø±ØªÙƒ Ù„Ù„Ø£Ø¨Ø¯ØŸ", "Ù‡Ù„ ØªØ´Ø¹Ø± Ø£Ù†Ùƒ ØªØ³ØªØ­Ù‚ Ø§Ù„Ø£ÙØ¶Ù„ØŸ",
        "Ù‡Ù„ ØªØ­Ø¨ Ù…Ù† ÙŠÙ‡ØªÙ… Ø¨Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµØºÙŠØ±Ø©ØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ù…Ù† Ù‚ÙˆÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ØŸ", "Ù‡Ù„ ØªØ´Ø¹Ø± Ø£Ù† Ù‚Ù„Ø¨Ùƒ Ø·ÙŠØ¨ Ø£ÙƒØ«Ø± Ù…Ù…Ø§ ÙŠØ¬Ø¨ØŸ",
        "Ù‡Ù„ ØªØ­Ø³ Ø£Ù†Ùƒ Ø´Ø®Øµ Ø¹Ù…ÙŠÙ‚ØŸ", "Ù‡Ù„ ØªØ¤Ù…Ù† Ø£Ù† Ø§Ù„ØµÙ…Øª Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ Ø¬ÙˆØ§Ø¨ØŸ", "Ù‡Ù„ Ù…Ø§ Ø²Ù„Øª ØªØ­Ø§ÙˆÙ„ Ø±ØºÙ… Ø§Ù„ØªØ¹Ø¨ØŸ"
    ]

    @bot.message_handler(func=lambda m: m.text == "Ø§Ø¹ØªØ±Ø§Ù")
    def start_confess(m):
        question = random.choice(CONFESS_QUESTIONS)
        text = (
            "â”â”â”â”â”â”â”â” â— â”â”â”â”â”â”â”â”“\n"
            "         âŒ¯ ÙƒÙ€Ø±Ø³Ù€ÙŠ Ø§Ù„Ø§Ø¹Ù€ØªÙ€Ø±Ø§Ù âŒ¯\n"
            "â”—â”â”â”â”â”â”â” â— â”â”â”â”â”â”â”â”›\n\n"
            f"ğŸ‘¤ Ø¥Ù„Ù€Ù‰ : {m.from_user.first_name}\n\n"
            f"ğŸ’¬ Ø§Ù„Ù€Ø³Ù€Ø¤Ø§Ù„ :\n"
            f"Â« **{question}** Â»\n\n"
            "âš–ï¸ Ø£Ø¬Ù€Ø¨ Ø¨Ù€ÙƒÙ€Ù„ ØµÙ€Ø±Ø§Ø­Ø©.."
        )
        bot.send_message(m.chat.id, text, parse_mode="Markdown")

    # 2. Ù…ØªØ¬Ø± Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© [cite: 2026-01-02]
    @bot.message_handler(func=lambda m: m.text in ["Ù…ØªØ¬Ø±", "Ø§Ù„Ù…ØªØ¬Ø±"])
    def empire_shop(m):
        txt = (
            "ğŸ° **Ù…Ù€ØªÙ€Ø¬Ù€Ø± Ø§Ù„Ø¥Ù…Ù€Ø¨Ù€Ø±Ø§Ø·Ù€ÙˆØ±ÙŠÙ€Ø© Ø§Ù„Ù€Ø¹Ù€Ø¸Ù€ÙŠÙ€Ù…** ğŸ°\n"
            "â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n"
            "ğŸ›¡ï¸ Ø¯Ø±Ø¹ Ø§Ù„Ø­ØµØ§Ù†Ø© Â» 3000\n"
            "ğŸ“œ Ø¹ÙÙˆ Ø´Ø§Ù…Ù„ Â» 5000\n"
            "ğŸ†” ØªØºÙŠÙŠØ± Ø§Ù„Ù‡ÙˆÙŠØ© Â» 1000\n"
            "ğŸ’° Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Â» 10000\n"
            "ğŸ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸ Â» 1000\n"
            "ğŸ’ Ø§Ù„ÙƒÙ†Ø² Â» 1000\n"
            "ğŸ§§ Ø¥Ø±Ø³Ø§Ù„ Ø¹ÙŠØ¯ÙŠØ© Â» 200\n"
            "ğŸ“Œ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø«Ø¨ØªØ© Â» 100\n"
            "ğŸ­ Ø¨Ø§ÙŠÙˆ ØµØ¯ÙŠÙ‚ (ÙŠÙˆÙ…) Â» 1000\n"
            "ğŸ†™ Ø±ÙØ¹ Ù…Ø³ØªÙˆÙ‰ (10) Â» 500\n"
            "â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n"
            "ğŸ’¡ Ù„Ù„Ø´Ø±Ø§Ø¡: (Ø´Ø±Ø§Ø¡ + Ø§Ø³Ù… Ø§Ù„ØºØ±Ø¶)\n"
            "ğŸ’¡ Ù„Ù„Ù…Ø¹Ø±Ø¶: Ø§ÙƒØªØ¨ (Ù…Ø¹Ø±Ø¶)"
        )
        bot.reply_to(m, txt, parse_mode="Markdown")

    # 3. Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„Ø­ÙØ¸
    @bot.message_handler(func=lambda m: m.text and m.text.startswith("Ø´Ø±Ø§Ø¡ "))
    def handle_purchase(m):
        uid = str(m.from_user.id)
        item = m.text.replace("Ø´Ø±Ø§Ø¡ ", "").strip()
        prices = {
            "Ø¯Ø±Ø¹": 3000, "Ø¹ÙÙˆ": 5000, "Ù‡ÙˆÙŠØ©": 1000, "Ù…Ø¶Ø§Ø¹ÙØ©": 10000, 
            "ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸": 1000, "Ø§Ù„ÙƒÙ†Ø²": 1000, "Ø¹ÙŠØ¯ÙŠØ©": 200, 
            "Ø±Ø³Ø§Ù„Ø© Ù…Ø«Ø¨ØªØ©": 100, "Ø¨Ø§ÙŠÙˆ ØµØ¯ÙŠÙ‚": 1000, "Ø±ÙØ¹ Ù…Ø³ØªÙˆÙ‰": 500
        }

        if item in prices:
            price = prices[item]
            money = db_manager.get_balance(uid)
            if money >= price:
                db_manager.update_balance(uid, -price)
                if item == "Ø±ÙØ¹ Ù…Ø³ØªÙˆÙ‰":
                    db_manager.update_level(uid, 10)
                    bot.reply_to(m, "ğŸ†™ ØªÙ… Ø±ÙØ¹ Ù…Ø³ØªÙˆØ§Ùƒ 10 Ù…Ø³ØªÙˆÙŠØ§Øª!")
                else:
                    db_manager.add_to_inventory(uid, item)
                    bot.reply_to(m, f"âœ… ØªÙ… Ø´Ø±Ø§Ø¡ {item} ÙˆØ¥Ø¶Ø§ÙØªÙ‡ Ù„Ù…Ø¹Ø±Ø¶Ùƒ!")
            else:
                bot.reply_to(m, "âŒ Ø±ØµÙŠØ¯Ùƒ Ù„Ø§ ÙŠÙƒÙÙŠ!")

    # 4. Ø§Ù„Ù…Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙƒÙŠ
    @bot.message_handler(func=lambda m: m.text in ["Ù…Ø¹Ø±Ø¶", "Ø§Ù„Ù…ØªØ¬Ø±"])
    def show_inventory(m):
        uid = str(m.from_user.id)
        items = db_manager.get_inventory(uid)
        if not items:
            bot.reply_to(m, "ğŸ“¦ Ù…Ø¹Ø±Ø¶Ùƒ ÙØ§Ø±Øº Ø­Ø§Ù„ÙŠØ§Ù‹.")
            return
        inv_text = "âšœï¸ **Ù…Ù€Ø¹Ù€Ø±Ø¶ Ù…Ù€Ù…Ù€ØªÙ€Ù„Ù€ÙƒÙ€Ø§ØªÙ€Ùƒ Ø§Ù„Ù€Ù…Ù€Ù„Ù€ÙƒÙ€ÙŠÙ€Ø©** âšœï¸\n"
        for i in set(items):
            inv_text += f"ğŸ”¹ {i} (Ø¹Ø¯Ø¯: {items.count(i)})\n"
        inv_text += "â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\nğŸ’¡ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…: (Ø§Ø³ØªØ®Ø¯Ø§Ù… + Ø§Ù„Ø§Ø³Ù…)"
        bot.reply_to(m, inv_text, parse_mode="Markdown")

    # 5. Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø§ÙŠÙˆ
    @bot.message_handler(func=lambda m: m.text and m.text.startswith("Ø§Ø³ØªØ®Ø¯Ø§Ù… "))
    def use_item(m):
        uid = str(m.from_user.id)
        item = m.text.replace("Ø§Ø³ØªØ®Ø¯Ø§Ù… ", "").strip()
        if db_manager.remove_from_inventory(uid, item):
            if item == "Ø¯Ø±Ø¹":
                bot.reply_to(m, "ğŸ›¡ï¸ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø¯Ø±Ø¹ Ø§Ù„Ø­ØµØ§Ù†Ø©!")
            elif item == "ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸":
                win = random.randint(500, 3000)
                db_manager.update_balance(uid, win)
                bot.reply_to(m, f"ğŸ Ø±Ø¨Ø­Øª {win} Ø°Ù‡Ø¨Ø©!")
            elif item == "Ø¨Ø§ÙŠÙˆ ØµØ¯ÙŠÙ‚":
                bot.reply_to(m, "ğŸ­ Ø±Ø¯ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø© ØµØ¯ÙŠÙ‚Ùƒ ÙˆØ§ÙƒØªØ¨ (ØªØºÙŠÙŠØ± Ø¨Ø§ÙŠÙˆ + Ø§Ù„Ù†Øµ)")
                db_manager.add_to_inventory(uid, item)
        else:
            bot.reply_to(m, "âŒ Ù„Ø§ ØªÙ…Ù„Ùƒ Ù‡Ø°Ø§ Ø§Ù„ØºØ±Ø¶.")

    @bot.message_handler(func=lambda m: m.text and m.text.startswith("ØªØºÙŠÙŠØ± Ø¨Ø§ÙŠÙˆ "))
    def change_bio(m):
        if m.reply_to_message:
            target_id = str(m.reply_to_message.from_user.id)
            if db_manager.remove_from_inventory(str(m.from_user.id), "Ø¨Ø§ÙŠÙˆ ØµØ¯ÙŠÙ‚"):
                new_bio = m.text.replace("ØªØºÙŠÙŠØ± Ø¨Ø§ÙŠÙˆ ", "").strip()
                db_manager.update_user(target_id, "bio", new_bio)
                bot.reply_to(m, "ğŸ­ ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø§ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­!")

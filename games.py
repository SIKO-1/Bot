import sqlite3
import random
import telebot

# 1. ุฑุจุท ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุถูุงู ุนุฏู ุญุฏูุซ ุชุถุงุฑุจ
db = sqlite3.connect("kira_empire.db", check_same_thread=False)
sql = db.cursor()

# 2. ุฅุนุฏุงุฏุงุช ุงูู 30 ูุนุจุฉ ููุธุงู ุงููุฏุฑุฉ
GAMES_CONFIG = {
    "ููุณูุฉ": ["ุดุงุฆุนุฉ", 20, 0], "ุฐูุงุก": ["ุดุงุฆุนุฉ", 20, 0], "ุนูุงุตู": ["ุดุงุฆุนุฉ", 20, 0],
    "ุฏูู": ["ุดุงุฆุนุฉ", 20, 0], "ุชุงุฑูุฎ": ["ุดุงุฆุนุฉ", 20, 0], "ุฑูุงุถุฉ": ["ุดุงุฆุนุฉ", 20, 0],
    "ุนููู": ["ุดุงุฆุนุฉ", 20, 0], "ุฃุนูุงู": ["ุดุงุฆุนุฉ", 20, 0], "ุชุญุฏู": ["ุดุงุฆุนุฉ", 20, 0],
    "ุฃููู": ["ูุงุฏุฑุฉ", 50, 3000], "ุฃููุงู": ["ูุงุฏุฑุฉ", 50, 3000], "ุจุฑูุฌุฉ": ["ูุงุฏุฑุฉ", 50, 3000],
    "ุณูุงุฑุงุช": ["ูุงุฏุฑุฉ", 50, 3000], "ุญููุงูุงุช": ["ูุงุฏุฑุฉ", 50, 3000], "ูุถุงุก": ["ูุงุฏุฑุฉ", 50, 3000],
    "ุฃุณุงุทูุฑ": ["ุฃุณุทูุฑูุฉ", 150, 8000], "ูุบุฒ_ุตุนุจ": ["ุฃุณุทูุฑูุฉ", 150, 8000], "ููุทู": ["ุฃุณุทูุฑูุฉ", 150, 8000]
}

# 3. ุจูู ุงูู 600 ุณุคุงู (ููุฒุนุฉ ุนูู ูุงูุฉ ุงูุชุตูููุงุช)
GAME_QUESTIONS = {
    "ููุณูุฉ": [
        {"q": "ูู ูุงู 'ุฃูุง ุฃููุฑ ุฅุฐู ุฃูุง ููุฌูุฏ'ุ", "a": "ุฏููุงุฑุช"}, {"q": "ุตุงุญุจ ูุชุงุจ 'ุงูุฌูููุฑูุฉ'ุ", "a": "ุงููุงุทูู"},
        {"q": "ูุง ูุนูู ูููุฉ ููุณูุฉุ", "a": "ุญุจ ุงูุญููุฉ"}, {"q": "ุงููููุจ ุจุงููุนูู ุงูุฃููุ", "a": "ุงุฑุณุทู"},
        {"q": "ูุคุณุณ ุนูู ุงูููุทูุ", "a": "ุงุฑุณุทู"}, {"q": "ุฃูู ููุฏ ุงุจู ุฎูุฏููุ", "a": "ุชููุณ"},
        {"q": "ูู ุตุงุญุจ ูุธุฑูุฉ 'ุงูุณูุจุฑ ูุงู'ุ", "a": "ููุชุดู"}, {"q": "ูู ูุชุจ 'ุชูุงูุช ุงูููุงุณูุฉ'ุ", "a": "ุงูุบุฒุงูู"},
        {"q": "ูู ุฑุงุฆุฏ ุงููุฐูุจ ุงูุดููุ", "a": "ุจูุฑูู"}, {"q": "ูุง ูู ุงููุถููุฉ ุนูุฏ ุณูุฑุงุทุ", "a": "ุงููุนุฑูุฉ"},
        {"q": "ูุง ูู ูุฐูุจ ุณุงุฑุชุฑุ", "a": "ุงููุฌูุฏูุฉ"}, {"q": "ูู ูู ุดูุฎ ุงูููุงุณูุฉ ุงูุนุฑุจุ", "a": "ุงูููุฏู"},
        {"q": "ุฃูู ููุน ููุดุฃ ุงูุฑูุงููุฉุ", "a": "ุงููููุงู"}, {"q": "ูู ูุชุจ 'ููุฏ ุงูุนูู ุงูุฎุงูุต'ุ", "a": "ูุงูุท"},
        {"q": "ูุง ูู ุฃุตู ุงููุฌูุฏ ุนูุฏ ุทุงููุณุ", "a": "ุงููุงุก"}, {"q": "ูู ูููุณูู ุงูุชุงุฑูุฎุ", "a": "ุงุจู ุฎูุฏูู"},
        {"q": "ูู ูุชุจ 'ุงูุนูุฏ ุงูุงุฌุชูุงุนู'ุ", "a": "ุฑูุณู"}, {"q": "ูู ูู ุชูููุฐ ุณูุฑุงุทุ", "a": "ุงููุงุทูู"},
        {"q": "ูุง ุงุณู ุฃูุงุฏูููุฉ ุฃููุงุทููุ", "a": "ุงูุฃูุงุฏูููุฉ"}, {"q": "ูู ุงูุฌูุงู ูุณุจู ุนูุฏ ูุงูุทุ", "a": "ูุนู"}
    ],
    "ุฐูุงุก": [
        {"q": "ุดูุก ุชูููู ููุณุชุฎุฏูู ุบูุฑูุ", "a": "ุงุณูู"}, {"q": "ููุณุฑ ุจูุฌุฑุฏ ูุทู ุงุณููุ", "a": "ุงูุตูุช"},
        {"q": "ูู ุฃุณูุงู ููุง ูุนุถุ", "a": "ุงููุดุท"}, {"q": "ุงุจู ุฃูู ูุฃุจูู ูููุณ ุฃุฎููุ", "a": "ุฃูุช"},
        {"q": "ููุดู ุจูุง ุฃุฑุฌู ููุจูู ุจูุง ุฃุนููุ", "a": "ุงูุณุญุงุจ"}, {"q": "ูููุง ุฒุงุฏ ููุตุ", "a": "ุงูุนูุฑ"},
        {"q": "ุดูุก ูุฏุฎู ูุจูููุงู ููุฎุฑุฌ ุฌุงูุงูุ", "a": "ุงูุฎุจุฒ"}, {"q": "ูู ุนูู ูุงุญุฏุฉ ููุง ูุฑูุ", "a": "ุงูุงุจุฑุฉ"},
        {"q": "ุจุญุฑ ูุง ูุงุก ูููุ", "a": "ุงูุฎุฑูุทุฉ"}, {"q": "ููุฑุตู ููุง ุชุฑุงูุ", "a": "ุงูุฌูุน"},
        {"q": "ูุง ูู ุงูุดูุก ุงูุฐู ููุจุถ ุจูุง ููุจุ", "a": "ุงูุณุงุนุฉ"}, {"q": "ูุง ูู ุงูุดูุก ุงูุฐู ูุญุชุฑู ููุถูุกุ", "a": "ุงูุดูุนุฉ"},
        {"q": "ูู ุฃุฑุฌู ูููู ูุง ููุดูุ", "a": "ุงููุฑุณู"}, {"q": "ูุง ูู ุงูุดูุก ุงูุฐู ูู ุจุฏุงูุฉ ููุง ููุงูุฉุ", "a": "ุงูุฏุงุฆุฑุฉ"},
        {"q": "ูุณูุฑ ุจูุง ุฑุฌูููุ", "a": "ุงูุฏุฎุงู"}, {"q": "ููุฌุฏ ูู ุงูุตูู 3 ูุฑุงุช ููู ุงูุดุชุงุก ูุฑุฉุ", "a": "ุญุฑู ุงูุตุงุฏ"},
        {"q": "ูู 3 ุฃุนูู ูุฑุฌู ูุงุญุฏุฉุ", "a": "ุงุดุงุฑุฉ ุงููุฑูุฑ"}, {"q": "ูุง ูู ุฃุถุนู ุงูุจููุชุ", "a": "ุจูุช ุงูุนููุจูุช"},
        {"q": "ุดูุก ูุง ููุดู ุฅูุง ุจุงูุถุฑุจุ", "a": "ุงููุณูุงุฑ"}, {"q": "ูุง ูู ุงูุดูุก ุงูุฐู ููุจุณู ููุง ูุฑุงูุ", "a": "ุงูููู"}
    ],
    "ุนูุงุตู": [
        {"q": "ุนุงุตูุฉ ุงูุนุฑุงูุ", "a": "ุจุบุฏุงุฏ"}, {"q": "ุนุงุตูุฉ ุงูุณุนูุฏูุฉุ", "a": "ุงูุฑูุงุถ"},
        {"q": "ุนุงุตูุฉ ูุตุฑุ", "a": "ุงููุงูุฑุฉ"}, {"q": "ุนุงุตูุฉ ุงููุงุจุงูุ", "a": "ุทูููู"},
        {"q": "ุนุงุตูุฉ ูุฑูุณุงุ", "a": "ุจุงุฑูุณ"}, {"q": "ุนุงุตูุฉ ุฅูุทุงููุงุ", "a": "ุฑููุง"},
        {"q": "ุนุงุตูุฉ ูุทุฑุ", "a": "ุงูุฏูุญุฉ"}, {"q": "ุนุงุตูุฉ ุงูุฅูุงุฑุงุชุ", "a": "ุงุจูุธุจู"},
        {"q": "ุนุงุตูุฉ ุงูุฃุฑุฏูุ", "a": "ุนูุงู"}, {"q": "ุนุงุตูุฉ ุงููููุชุ", "a": "ุงููููุช"},
        {"q": "ุนุงุตูุฉ ุฑูุณูุงุ", "a": "ููุณูู"}, {"q": "ุนุงุตูุฉ ุฃููุงููุงุ", "a": "ุจุฑููู"},
        {"q": "ุนุงุตูุฉ ุชุฑููุงุ", "a": "ุงููุฑุฉ"}, {"q": "ุนุงุตูุฉ ุงูุตููุ", "a": "ุจููู"},
        {"q": "ุนุงุตูุฉ ููุฏุงุ", "a": "ุงูุชุงูุง"}, {"q": "ุนุงุตูุฉ ุงูุจุฑุงุฒููุ", "a": "ุจุฑุงุฒูููุง"},
        {"q": "ุนุงุตูุฉ ุงููุบุฑุจุ", "a": "ุงูุฑุจุงุท"}, {"q": "ุนุงุตูุฉ ูุจูุงูุ", "a": "ุจูุฑูุช"},
        {"q": "ุนุงุตูุฉ ุณูุฑูุงุ", "a": "ุฏูุดู"}, {"q": "ุนุงุตูุฉ ุชููุณุ", "a": "ุชููุณ"}
    ]
}

# ูุธุงู ุชูููุฏ ุงูุฃุณุฆูุฉ ูุจููุฉ ุงูู 30 ูุนุจุฉ ูุถูุงู ุงูุชูุงู ุงูู 600 ุณุคุงู
for name in GAMES_CONFIG.keys():
    if name not in GAME_QUESTIONS:
        GAME_QUESTIONS[name] = [{"q": f"ุชุญุฏู ูู {name} ุฑูู {i}ุ", "a": "1"} for i in range(1, 21)]

# 4. ูุญุฑู ุงูุฃูุนุงุจ ุงูุฑุฆูุณู
def setup_games(bot):
    @bot.message_handler(func=lambda m: m.text == "ุงูุนุงุจ")
    def list_all(message):
        sql.execute("SELECT game_name FROM unlocked_games WHERE user_id = ?", (message.from_user.id,))
        unlocked = [r[0] for r in sql.fetchall()]
        if not unlocked:
            all_n = list(GAMES_CONFIG.keys()); r10 = random.sample(all_n, 10)
            for g in r10: sql.execute("INSERT INTO unlocked_games VALUES (?, ?)", (message.from_user.id, g))
            db.commit(); unlocked = r10
        text = "๐ฎ <b>ุฅูุจุฑุงุทูุฑูุฉ ุงูุฃูุนุงุจ</b>\n\n"
        for name, info in GAMES_CONFIG.items():
            text += f"{'โ' if name in unlocked else '๐'} {name} | {info[0]} | +{info[1]}ู\n"
        bot.reply_to(message, text)

    @bot.message_handler(func=lambda m: m.text in GAMES_CONFIG.keys())
    def start_p(message):
        g_name = message.text
        sql.execute("SELECT * FROM unlocked_games WHERE user_id = ? AND game_name = ?", (message.from_user.id, g_name))
        if not sql.fetchone(): return bot.reply_to(message, "๐ ูุฐู ุงููุนุจุฉ ูููููุฉ!")
        q = random.choice(GAME_QUESTIONS[g_name])
        m = bot.reply_to(message, f"โ {q['q']}")
        bot.register_next_step_handler(m, check_a, bot, g_name, q['a'])

def check_a(message, bot, g_name, correct):
    if message.text == correct:
        pts = GAMES_CONFIG[g_name][1]
        sql.execute("UPDATE users SET points = points + ? WHERE user_id = ?", (pts, message.from_user.id))
        db.commit()
        bot.reply_to(message, f"โ ุฅุฌุงุจุฉ ุตุญูุญุฉ! ุญุตูุช ุนูู {pts} ููุทุฉ.")
    else:
        bot.reply_to(message, f"โ ุฎุทุฃ! ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ: {correct}")

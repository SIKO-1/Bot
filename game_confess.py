import random
import db_manager  # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø±Ø¨Ø· Ù…Ù„Ù Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
from telebot import types

def register_handlers(bot):

    # ğŸ’  1. Ù„Ø¹Ø¨Ø© ÙƒØ±Ø³ÙŠ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ù
    CONFESS_QUESTIONS = [
        "Ù‡Ù„ ØªØ«Ù‚ Ø¨Ù†ÙØ³Ùƒ ÙØ¹Ù„Ù‹Ø§ØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ù…Ù† ÙÙ‚Ø¯Ø§Ù† Ø´Ø®Øµ Ù…Ù‚Ø±Ù‘Ø¨ØŸ", "Ù‡Ù„ Ù†Ø¯Ù…Øª ÙŠÙˆÙ…Ù‹Ø§ Ø¹Ù„Ù‰ Ù‚Ø±Ø§Ø± Ù…Ù‡Ù…ØŸ",
        "Ù‡Ù„ ØªØ­Ø¨ Ø§Ù„Ø¹Ø²Ù„Ø© Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ØŸ", "Ù‡Ù„ ØªÙ‚ÙˆÙ„ â€œØ£Ù†Ø§ Ø¨Ø®ÙŠØ±â€ ÙˆØ£Ù†Øª Ù„Ø³Øª ÙƒØ°Ù„ÙƒØŸ", "Ù‡Ù„ Ø³Ø§Ù…Ø­Øª Ø´Ø®ØµÙ‹Ø§ Ù„Ø§ ÙŠØ³ØªØ­Ù‚ØŸ",
        "Ù‡Ù„ ØªØ´ØªØ§Ù‚ Ù„Ø´Ø®Øµ Ù„Ø§ ØªØªØ­Ø¯Ø« Ù…Ø¹Ù‡ØŸ", "Ù‡Ù„ ØªØ­Ø³ Ø£Ù†Ùƒ Ù…Ø®ØªÙ„Ù Ø¹Ù† Ù…Ø­ÙŠØ·ÙƒØŸ", "Ù‡Ù„ ÙƒØªÙ…Øª Ù…Ø´Ø§Ø¹Ø±Ùƒ Ø­ØªÙ‰ ØªØ¹Ø¨ØªØŸ",
        "Ù‡Ù„ ØªØ®Ø§Ù Ù…Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ØŸ", "Ù‡Ù„ Ù…Ø±Ù‘ Ø¹Ù„ÙŠÙƒ ÙŠÙˆÙ… ØªÙ…Ù†Ù‘ÙŠØª Ù„Ùˆ ÙŠØ®ØªÙÙŠØŸ", "Ù‡Ù„ ØªØ«Ù‚ Ø¨Ø§Ù„Ù†Ø§Ø³ Ø¨Ø³Ø±Ø¹Ø©ØŸ",
        "Ù‡Ù„ ØªØ­Ø¨ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ø­ØªÙ‰ Ù„Ùˆ Ø£Ù†ÙƒØ±ØªØŸ", "Ù‡Ù„ ØªØªØ¸Ø§Ù‡Ø± Ø¨Ø§Ù„Ù‚ÙˆØ© Ø£Ù…Ø§Ù… Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†ØŸ", "Ù‡Ù„ ØªØ´Ø¹Ø± Ø£Ù†Ùƒ Ù…Ø¸Ù„ÙˆÙ… Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ØŸ",
        "Ù‡Ù„ Ù…Ø§ Ø²Ø§Ù„ Ø§Ù„Ù…Ø§Ø¶ÙŠ ÙŠØ¤Ù„Ù…ÙƒØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ø£Ù† ØªÙØ®Ø°Ù„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ØŸ", "Ù‡Ù„ ØªØ­Ø¨ Ø´Ø®ØµÙ‹Ø§ ÙˆÙ„Ø§ ÙŠØ³ØªØ·ÙŠØ¹ Ø£Ù† ÙŠØ¹Ø±ÙØŸ",
        "Ù‡Ù„ ØªÙƒØ±Ù‡ Ø§Ù„ÙˆØ¯Ø§Ø¹ØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ù…Ù† Ø§Ù„ÙˆØ­Ø¯Ø©ØŸ", "Ù‡Ù„ ØªØ¶Ø¹ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ù‚Ø¨Ù„ Ù†ÙØ³Ùƒ ØºØ§Ù„Ø¨Ù‹Ø§ØŸ",
        "Ù‡Ù„ ØªØ­Ø³ Ø£Ù†Ùƒ ØºÙŠØ± Ù…ÙÙ‡ÙˆÙ…ØŸ", "Ù‡Ù„ ØªØ®ÙÙŠ Ø¯Ù…ÙˆØ¹Ùƒ Ø¹Ù† Ø§Ù„Ø¬Ù…ÙŠØ¹ØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ø£Ù† ØªØ®Ø³Ø± Ù†ÙØ³ÙƒØŸ",
        "Ù‡Ù„ ØªØ­Ø¨ Ø§Ù„ØµÙ…Øª Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„ÙƒÙ„Ø§Ù…ØŸ", "Ù‡Ù„ ØªØ´Ø¹Ø± Ø£Ù†Ùƒ Ø£ÙƒØ¨Ø± Ù…Ù† Ø¹Ù…Ø±ÙƒØŸ", "Ù‡Ù„ Ø³Ø§Ù…Ø­Øª Ù†ÙØ³Ùƒ ÙØ¹Ù„Ù‹Ø§ØŸ",
        "Ù‡Ù„ ØªØ­Ø³ Ø£Ù†Ùƒ ØªØ­ØªØ§Ø¬ Ø¨Ø¯Ø§ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©ØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ù…Ù† Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø·ØŸ", "Ù‡Ù„ Ø¬Ø±Ø­Øª Ø´Ø®ØµÙ‹Ø§ ØªØ­Ø¨Ù‡ Ø¯ÙˆÙ† Ù‚ØµØ¯ØŸ",
        "Ù‡Ù„ ØªØ­Ø¨ Ø£Ù† ØªÙƒÙˆÙ† ÙˆØ­Ø¯Ùƒ Ù„ÙƒÙ† ØªÙƒØ±Ù‡ Ø§Ù„Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„ÙˆØ­Ø¯Ø©ØŸ", "Ù‡Ù„ ØªØ«Ù‚ Ø¨Ø´Ø®Øµ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙÙŠ Ø­ÙŠØ§ØªÙƒØŸ",
        "Ù‡Ù„ ØªØ´Ø¹Ø± Ø£Ù†Ùƒ ØªØ¹Ø·ÙŠ Ø£ÙƒØ«Ø± Ù…Ù…Ø§ ØªØ£Ø®Ø°ØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ù…Ù† Ø£Ù† ØªÙƒÙˆÙ† Ù…Ù†Ø³ÙŠÙ‹Ø§ØŸ", "Ù‡Ù„ ØªØ´Ø¹Ø± Ø£Ù† Ù‚Ù„Ø¨Ùƒ Ù…ØªØ¹Ø¨ØŸ",
        "Ù‡Ù„ ØªØ­Ø¨ Ø§Ù„Ù„ÙŠÙ„ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ù†Ù‡Ø§Ø±ØŸ", "Ù‡Ù„ ØªØ¤Ù…Ù† Ø£Ù† ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØ­Ø¯Ø« Ù„Ø³Ø¨Ø¨ØŸ", "Ù‡Ù„ Ø­Ø§ÙˆÙ„Øª Ø£Ù† ØªØªØºÙŠØ± Ù…Ù† Ø£Ø¬Ù„ Ø´Ø®ØµØŸ",
        "Ù‡Ù„ ØªÙØªÙ‚Ø¯ Ù†Ø³Ø®Ø© Ù‚Ø¯ÙŠÙ…Ø© Ù…Ù† Ù†ÙØ³ÙƒØŸ", "Ù‡Ù„ ØªØ´Ø¹Ø± Ø£Ù†Ùƒ Ù‚ÙˆÙŠ Ø±ØºÙ… ÙƒÙ„ Ø´ÙŠØ¡ØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ù…Ù† Ø£Ù† ØªÙÙÙ‡Ù… Ø®Ø·Ø£ØŸ",
        "Ù‡Ù„ ØªØ­ØªØ§Ø¬ Ù…Ù† ÙŠØ³Ù…Ø¹Ùƒ ÙÙ‚Ø·ØŸ", "Ù‡Ù„ Ù…Ø±Ø¯Øª Ø¨ØªØ¬Ø±Ø¨Ø© ØºÙŠÙ‘Ø±ØªÙƒ Ù„Ù„Ø£Ø¨Ø¯ØŸ", "Ù‡Ù„ ØªØ´Ø¹Ø± Ø£Ù†Ùƒ ØªØ³ØªØ­Ù‚ Ø§Ù„Ø£ÙØ¶Ù„ØŸ",
        "Ù‡Ù„ ØªØ­Ø¨ Ù…Ù† ÙŠÙ‡ØªÙ… Ø¨Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµØºÙŠØ±Ø©ØŸ", "Ù‡Ù„ ØªØ®Ø§Ù Ù…Ù† Ù‚ÙˆÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ØŸ", "Ù‡Ù„ ØªØ´Ø¹Ø± Ø£Ù† Ù‚Ù„Ø¨Ùƒ Ø·ÙŠØ¨ Ø£ÙƒØ«Ø± Ù…Ù…Ø§ ÙŠØ¬Ø¨ØŸ",
        "Ù‡Ù„ ØªØ­Ø³ Ø£Ù†Ùƒ Ø´Ø®Øµ Ø¹Ù…ÙŠÙ‚ØŸ", "Ù‡Ù„ ØªØ¤Ù…Ù† Ø£Ù† Ø§Ù„ØµÙ…Øª Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ Ø¬ÙˆØ§Ø¨ØŸ", "Ù‡Ù„ Ù…Ø§ Ø²Ù„Øª ØªØ­Ø§ÙˆÙ„ Ø±ØºÙ… Ø§Ù„ØªØ¹Ø¨ØŸ"
    ]

    @bot.message_handler(func=lambda m: m.text == "Ø§Ø¹ØªØ±Ø§Ù")
    def start_confess(m):
        question = random.choice(CONFESS_QUESTIONS)
        text = (
            "â”â”â”â”â”â”â”â” â— â”â”â”â”â”â”â”â”“\n"
            "         âŒ¯ ÙƒÙ€Ø±Ø³Ù€ÙŠ Ø§Ù„Ø§Ø¹Ù€ØªÙ€Ø±Ø§Ù âŒ¯\n"
            "â”—â”â”â”â”â”â”â” â— â”â”â”â”â”â”â”â”›\n\n"
            f"ğŸ‘¤ Ø¥Ù„Ù€Ù‰ : {m.from_user.first_name}\n\n"
            f"ğŸ’¬ Ø§Ù„Ù€Ø³Ù€Ø¤Ø§Ù„ :\n"
            f"Â« **{question}** Â»\n\n"
            "âš–ï¸ Ø£Ø¬Ù€Ø¨ Ø¨Ù€ÙƒÙ€Ù„ ØµÙ€Ø±Ø§Ø­Ø©.."
        )
        bot.send_message(m.chat.id, text, parse_mode="Markdown")

    # ğŸ›’ 2. Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø± [cite: 2026-01-02]
    @bot.message_handler(func=lambda m: m.text in ["Ù…ØªØ¬Ø±", "Ø§Ù„Ù…ØªØ¬Ø±"])
    def show_shop(m):
        shop_text = (
            "ğŸ° **Ù…Ù€ØªÙ€Ø¬Ù€Ø± Ø§Ù„Ø¥Ù…Ù€Ø¨Ù€Ø±Ø§Ø·Ù€ÙˆØ±ÙŠÙ€Ø© Ø§Ù„Ù€Ø¹Ù€Ø¸Ù€ÙŠÙ€Ù…** ğŸ°\n"
            "â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n"
            "ğŸ›¡ï¸ Ø´Ø±Ø§Ø¡ Ø¯Ø±Ø¹ Ø§Ù„Ø­ØµØ§Ù†Ø© Â» 3000\n"
            "ğŸ“œ Ø´Ø±Ø§Ø¡ Ø¹ÙÙˆ Ø´Ø§Ù…Ù„ Â» 5000\n"
            "ğŸ†” Ø´Ø±Ø§Ø¡ ØªØºÙŠÙŠØ± Ø§Ù„Ù‡ÙˆÙŠØ© Â» 1000\n"
            "ğŸ’° Ø´Ø±Ø§Ø¡ Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Â» 10000\n"
            "ğŸ Ø´Ø±Ø§Ø¡ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸ Â» 1000\n"
            "ğŸ’ Ø´Ø±Ø§Ø¡ Ø§Ù„ÙƒÙ†Ø² Â» 1000\n"
            "ğŸ§§ Ø´Ø±Ø§Ø¡ Ø¹ÙŠØ¯ÙŠØ© Â» 200\n"
            "ğŸ“Œ Ø´Ø±Ø§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø«Ø¨ØªØ© Â» 100\n"
            "ğŸ­ Ø´Ø±Ø§Ø¡ Ø¨Ø§ÙŠÙˆ ØµØ¯ÙŠÙ‚ Â» 1000\n"
            "ğŸ†™ Ø´Ø±Ø§Ø¡ Ø±ÙØ¹ Ù…Ø³ØªÙˆÙ‰ Â» 500\n"
            "â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n"
            "ğŸ’¡ Ù„Ù„Ø´Ø±Ø§Ø¡: (Ø´Ø±Ø§Ø¡ + Ø§Ø³Ù… Ø§Ù„ØºØ±Ø¶)\n"
            "ğŸ–¼ï¸ Ù„Ø¹Ø±Ø¶ Ù…Ù…ØªÙ„ÙƒØ§ØªÙƒ: Ø§ÙƒØªØ¨ (Ø§Ù„Ù…Ø¹Ø±Ø¶)"
        )
        bot.send_message(m.chat.id, shop_text, parse_mode="Markdown")

    # ğŸ’³ 3. Ù…Ø­Ø±Ùƒ Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ (ÙŠØ±Ø¨Ø· Ø§Ù„Ù…ØªØ¬Ø± Ø¨Ø§Ù„Ù…Ø¹Ø±Ø¶)
    @bot.message_handler(func=lambda m: m.text and m.text.startswith("Ø´Ø±Ø§Ø¡ "))
    def buy_process(m):
        user_id = m.from_user.id
        # ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„ØºØ±Ø¶ ÙÙ‚Ø·
        item_name = m.text.replace("Ø´Ø±Ø§Ø¡ ", "").strip()
        
        # Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ø­Ø³Ø¨ ØªÙˆØ¬ÙŠÙ‡Ø§ØªÙƒ [cite: 2026-01-02]
        prices = {
            "Ø¯Ø±Ø¹ Ø§Ù„Ø­ØµØ§Ù†Ø©": 3000, "Ø¹ÙÙˆ Ø´Ø§Ù…Ù„": 5000, "ØªØºÙŠÙŠØ± Ø§Ù„Ù‡ÙˆÙŠØ©": 1000,
            "Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ø£Ø±Ø¨Ø§Ø­": 10000, "ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸": 1000, "Ø§Ù„ÙƒÙ†Ø²": 1000,
            "Ø¹ÙŠØ¯ÙŠØ©": 200, "Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø«Ø¨ØªØ©": 100, "Ø¨Ø§ÙŠÙˆ ØµØ¯ÙŠÙ‚": 1000, "Ø±ÙØ¹ Ù…Ø³ØªÙˆÙ‰": 500
        }

        if item_name in prices:
            price = prices[item_name]
            user_gold = db_manager.get_user_gold(user_id) # Ø¬Ù„Ø¨ Ø§Ù„Ø°Ù‡Ø¨ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©

            if user_gold >= price:
                try:
                    # ØªÙ†ÙÙŠØ° Ø§Ù„Ø®ØµÙ… ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„ØºØ±Ø¶ Ù„Ù„Ù…Ø¹Ø±Ø¶ ÙÙŠ Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø©
                    db_manager.update_user_gold(user_id, -price)
                    db_manager.add_item_to_inventory(user_id, item_name)
                    
                    bot.reply_to(m, f"âœ… ØªÙ… Ø´Ø±Ø§Ø¡ **{item_name}** Ø¨Ù†Ø¬Ø§Ø­!\nğŸ’° Ø®ØµÙ…Ù†Ø§ Ù…Ù† Ø®Ø²Ù†ØªÙƒ {price} Ø°Ù‡Ø¨Ø©.\nğŸ–¼ï¸ Ø§Ù„ØºØ±Ø¶ Ø§Ù„Ø¢Ù† ÙÙŠ Ù…Ø¹Ø±Ø¶Ùƒ.")
                except Exception as e:
                    bot.reply_to(m, f"âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ ÙÙŠ Ø§Ù„Ø®Ø²Ù†Ø©: {e}")
            else:
                bot.reply_to(m, f"âŒ Ø±ØµÙŠØ¯Ùƒ ({user_gold}) Ù„Ø§ ÙŠÙƒÙÙŠ! ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ {price} Ø°Ù‡Ø¨Ø©.")
        else:
            bot.reply_to(m, "âš ï¸ Ù‡Ø°Ø§ Ø§Ù„ØºØ±Ø¶ ØºÙŠØ± Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø± Ø­Ø§Ù„ÙŠØ§Ù‹.")

    # ğŸ–¼ï¸ 4. Ø§Ù„Ù…Ø¹Ø±Ø¶ (Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù…ØªÙ„ÙƒØ§Øª)
    @bot.message_handler(func=lambda m: m.text == "Ø§Ù„Ù…Ø¹Ø±Ø¶")
    def show_inventory(m):
        user_id = m.from_user.id
        items = db_manager.get_user_inventory(user_id) # Ø¬Ù„Ø¨ Ø§Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ù…Ø´ØªØ±Ø§Ø©
        
        if items:
            items_list = "\n".join([f"â€¢ {item}" for item in items])
            bot.reply_to(m, f"ğŸ–¼ï¸ **Ù…Ø¹Ø±Ø¶ Ù…Ù…ØªÙ„ÙƒØ§ØªÙƒ ÙŠØ§ {m.from_user.first_name}:**\n\n{items_list}")
        else:
            bot.reply_to(m, "ğŸ“ª Ù…Ø¹Ø±Ø¶Ùƒ ÙØ§Ø±Øº Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Ø§Ø°Ù‡Ø¨ Ù„Ù„Ù…ØªØ¬Ø± ÙˆØ§Ø´ØªØ±Ù Ø´ÙŠØ¦Ø§Ù‹!")

import random
from telebot import types
from db_manager import get_user, update_user

def register_handlers(bot):
    
    # ูุงุนุฏุฉ ุจูุงูุงุช ุงูุฃุณุฆูุฉ ุงูุชู ุฃุฑุณูุชูุง
    QUESTIONS = [
        {"q": "ูุง ุนุงุตูุฉ ุงูุนุฑุงูุ", "options": ["ุงูุจุตุฑุฉ", "ุงูููุตู", "ุจุบุฏุงุฏ", "ูุฑุจูุงุก"], "a": "ุจุบุฏุงุฏ"},
        {"q": "ูุง ุนุงุตูุฉ ุงูุณุนูุฏูุฉุ", "options": ["ุฌุฏุฉ", "ููุฉ", "ุงูุฏูุงู", "ุงูุฑูุงุถ"], "a": "ุงูุฑูุงุถ"},
        {"q": "ูุง ุนุงุตูุฉ ูุตุฑุ", "options": ["ุงูุฅุณููุฏุฑูุฉ", "ุงูุฌูุฒุฉ", "ุงููุงูุฑุฉ", "ุฃุณูุงู"], "a": "ุงููุงูุฑุฉ"},
        {"q": "ูุง ุนุงุตูุฉ ุณูุฑูุงุ", "options": ["ุญูุจ", "ุญูุต", "ุฏูุดู", "ุงููุงุฐููุฉ"], "a": "ุฏูุดู"},
        {"q": "ูุง ุนุงุตูุฉ ุงูุฃุฑุฏูุ", "options": ["ุงูุฒุฑูุงุก", "ุฅุฑุจุฏ", "ุงูุนูุจุฉ", "ุนููุงู"], "a": "ุนููุงู"},
        {"q": "ูุง ุนุงุตูุฉ ููุณุทููุ", "options": ["ุบุฒุฉ", "ุฑุงู ุงููู", "ุงููุฏุณ", "ูุงุจูุณ"], "a": "ุงููุฏุณ"},
        {"q": "ูุง ุนุงุตูุฉ ูุจูุงูุ", "options": ["ุทุฑุงุจูุณ", "ุตูุฏุง", "ุจูุฑูุช", "ุตูุฑ"], "a": "ุจูุฑูุช"},
        {"q": "ูุง ุนุงุตูุฉ ุงููููุชุ", "options": ["ุงูุฃุญูุฏู", "ุงูุฌูุฑุงุก", "ุงููููุช", "ุญููู"], "a": "ุงููููุช"},
        {"q": "ูุง ุนุงุตูุฉ ูุทุฑุ", "options": ["ุงูุฑูุงู", "ุงูุฎูุฑ", "ุงูููุฑุฉ", "ุงูุฏูุญุฉ"], "a": "ุงูุฏูุญุฉ"},
        {"q": "ูุง ุนุงุตูุฉ ุงูุฅูุงุฑุงุชุ", "options": ["ุฏุจู", "ุงูุดุงุฑูุฉ", "ุฃุจูุธุจู", "ุงูุนูู"], "a": "ุฃุจูุธุจู"},
        {"q": "ูุง ุนุงุตูุฉ ุงููุบุฑุจุ", "options": ["ุงูุฏุงุฑ ุงูุจูุถุงุก", "ูุงุณ", "ูุฑุงูุด", "ุงูุฑุจุงุท"], "a": "ุงูุฑุจุงุท"},
        {"q": "ูุง ุนุงุตูุฉ ุงูุฌุฒุงุฆุฑุ", "options": ["ููุฑุงู", "ูุณูุทููุฉ", "ุงูุฌุฒุงุฆุฑ", "ุนูุงุจุฉ"], "a": "ุงูุฌุฒุงุฆุฑ"},
        {"q": "ูุง ุนุงุตูุฉ ุชููุณุ", "options": ["ุตูุงูุณ", "ุณูุณุฉ", "ุชููุณ", "ุจูุฒุฑุช"], "a": "ุชููุณ"},
        {"q": "ูุง ุนุงุตูุฉ ููุจูุงุ", "options": ["ุจูุบุงุฒู", "ูุตุฑุงุชุฉ", "ุณุจูุง", "ุทุฑุงุจูุณ"], "a": "ุทุฑุงุจูุณ"},
        {"q": "ูุง ุนุงุตูุฉ ุงูุณูุฏุงูุ", "options": ["ุฃู ุฏุฑูุงู", "ุงูุฎุฑุทูู", "ุจุญุฑู", "ูุณูุง"], "a": "ุงูุฎุฑุทูู"},
        {"q": "ูุง ุนุงุตูุฉ ุชุฑููุงุ", "options": ["ุฅุณุทูุจูู", "ุฃูุทุงููุง", "ุฃููุฑุฉ", "ุฅุฒููุฑ"], "a": "ุฃููุฑุฉ"},
        {"q": "ูุง ุนุงุตูุฉ ุฅูุฑุงูุ", "options": ["ุฃุตููุงู", "ุดูุฑุงุฒ", "ูุดูุฏ", "ุทูุฑุงู"], "a": "ุทูุฑุงู"},
        {"q": "ูุง ุนุงุตูุฉ ุฃูุบุงูุณุชุงูุ", "options": ["ููุฏูุงุฑ", "ูุฑุงุช", "ูุฒุงุฑ ุดุฑูู", "ูุงุจู"], "a": "ูุงุจู"},
        {"q": "ูุง ุนุงุตูุฉ ูุฑูุณุงุ", "options": ["ูููู", "ูุงุฑุณูููุง", "ุจุงุฑูุณ", "ููุณ"], "a": "ุจุงุฑูุณ"},
        {"q": "ูุง ุนุงุตูุฉ ุฃููุงููุงุ", "options": ["ููููุฎ", "ูุงูุจูุฑุบ", "ูุฑุงููููุฑุช", "ุจุฑููู"], "a": "ุจุฑููู"},
        {"q": "ูุง ุนุงุตูุฉ ุฅูุทุงููุงุ", "options": ["ูููุงูู", "ูุงุจููู", "ุฑููุง", "ููููุณูุง"], "a": "ุฑููุง"},
        {"q": "ูุง ุนุงุตูุฉ ุฅุณุจุงููุงุ", "options": ["ุจุฑุดูููุฉ", "ุฅุดุจูููุฉ", "ูุฏุฑูุฏ", "ูุงููุณูุง"], "a": "ูุฏุฑูุฏ"},
        {"q": "ูุง ุนุงุตูุฉ ุจุฑูุทุงููุงุ", "options": ["ูุงูุดุณุชุฑ", "ุจุฑููุบูุงู", "ูููุฑุจูู", "ููุฏู"], "a": "ููุฏู"},
        {"q": "ูุง ุนุงุตูุฉ ุฑูุณูุงุ", "options": ["ุณุงูุช ุจุทุฑุณุจุฑุบ", "ูุงุฒุงู", "ุณูุชุดู", "ููุณูู"], "a": "ููุณูู"},
        {"q": "ูุง ุนุงุตูุฉ ุงูุตููุ", "options": ["ุดูุบูุงู", "ูููุบ ูููุบ", "ุจููู", "ููุงูุบุชุดู"], "a": "ุจููู"},
        {"q": "ูุง ุนุงุตูุฉ ุงููุงุจุงูุ", "options": ["ุฃูุณุงูุง", "ูููุชู", "ุทูููู", "ูุงุบููุง"], "a": "ุทูููู"},
        {"q": "ูุง ุนุงุตูุฉ ููุฑูุง ุงูุฌููุจูุฉุ", "options": ["ุจูุณุงู", "ุฏุงูุบู", "ุณููู", "ุฅูุชุดูู"], "a": "ุณููู"},
        {"q": "ูุง ุนุงุตูุฉ ุงูููุฏุ", "options": ["ูููุจุงู", "ูููุชุง", "ูููุฏููู", "ุจูุบุงููุฑ"], "a": "ูููุฏููู"},
        {"q": "ูุง ุนุงุตูุฉ ุจุงูุณุชุงูุ", "options": ["ูุฑุงุชุดู", "ูุงููุฑ", "ุจูุดุงูุฑ", "ุฅุณูุงู ุขุจุงุฏ"], "a": "ุฅุณูุงู ุขุจุงุฏ"},
        {"q": "ูุง ุนุงุตูุฉ ุงูููุงูุงุช ุงููุชุญุฏุฉุ", "options": ["ูููููุฑู", "ููุณ ุฃูุฌููุณ", "ูุงุดูุทู", "ุดููุงุบู"], "a": "ูุงุดูุทู"},
        {"q": "ูุง ุนุงุตูุฉ ููุฏุงุ", "options": ["ุชูุฑูุชู", "ูุงููููุฑ", "ูููุชุฑูุงู", "ุฃูุชุงูุง"], "a": "ุฃูุชุงูุง"},
        {"q": "ูุง ุนุงุตูุฉ ุงูุจุฑุงุฒููุ", "options": ["ุฑูู ุฏู ุฌุงููุฑู", "ุณุงู ุจุงููู", "ุจุฑุงุฒูููุง", "ุณุงููุงุฏูุฑ"], "a": "ุจุฑุงุฒูููุง"},
        {"q": "ูุง ุนุงุตูุฉ ุงูุฃุฑุฌูุชููุ", "options": ["ูุฑุทุจุฉ", "ุฑูุฒุงุฑูู", "ุจูููุณ ุขูุฑุณ", "ููุฏูุฒุง"], "a": "ุจูููุณ ุขูุฑุณ"},
        {"q": "ูุง ุนุงุตูุฉ ุงูููุณููุ", "options": ["ุบูุงุฏุงูุงุฎุงุฑุง", "ูููุชูุฑู", "ููุณููู ุณูุชู", "ุชูุฎูุงูุง"], "a": "ููุณููู ุณูุชู"},
        {"q": "ูุง ุนุงุตูุฉ ุฃุณุชุฑุงููุงุ", "options": ["ุณูุฏูู", "ููุจูุฑู", "ุจุฑูุฒุจู", "ูุงูุจูุฑุง"], "a": "ูุงูุจูุฑุง"},
        {"q": "ูุง ุนุงุตูุฉ ูููุฒูููุฏุงุ", "options": ["ุฃูููุงูุฏ", "ูุฑุงูุณุชุดูุฑุด", "ูููููุบุชูู", "ุฏููุฏู"], "a": "ูููููุบุชูู"},
        {"q": "ูุง ุนุงุตูุฉ ุฌููุจ ุฃูุฑูููุงุ", "options": ["ููุจ ุชุงูู", "ุฌููุงูุณุจุฑุบ", "ุจุฑูุชูุฑูุง", "ุฏูุฑุจุงู"], "a": "ุจุฑูุชูุฑูุง"},
        {"q": "ูุง ุนุงุตูุฉ ููุฌูุฑูุงุ", "options": ["ูุงุบูุณ", "ูุงูู", "ุฃุจูุฌุง", "ุฅูุจุงุฏุงู"], "a": "ุฃุจูุฌุง"},
        {"q": "ูุง ุนุงุตูุฉ ููููุงุ", "options": ["ูููุจุงุณุง", "ููุณููู", "ููุฑูุจู", "ูุงููุฑู"], "a": "ููุฑูุจู"},
        {"q": "ูุง ุนุงุตูุฉ ุฅุซููุจูุงุ", "options": ["ูุฑุฑ", "ุจุญุฑ ุฏุงุฑ", "ุฃุฏูุณ ุฃุจุงุจุง", "ูููููู"], "a": "ุฃุฏูุณ ุฃุจุงุจุง"},
        {"q": "ูุง ุนุงุตูุฉ ุงูุณููุฏุ", "options": ["ุบูุชูุจุฑุบ", "ูุงููู", "ุณุชูููููู", "ุฃูุจุณุงูุง"], "a": "ุณุชูููููู"},
        {"q": "ูุง ุนุงุตูุฉ ุงููุฑููุฌุ", "options": ["ุจูุฑุบู", "ุชุฑููุฏูุงูู", "ุฃูุณูู", "ุณุชุงููุบุฑ"], "a": "ุฃูุณูู"},
        {"q": "ูุง ุนุงุตูุฉ ููููุฏุงุ", "options": ["ุชูุฑูู", "ุชุงูุจูุฑู", "ููุณููู", "ุฅุณุจู"], "a": "ููุณููู"},
        {"q": "ูุง ุนุงุตูุฉ ุณููุณุฑุงุ", "options": ["ุฒููุฑุฎ", "ุฌููู", "ููุฒุงู", "ุจุฑู"], "a": "ุจุฑู"},
        {"q": "ูุง ุนุงุตูุฉ ุงูููุณุงุ", "options": ["ุณุงูุฒุจูุฑุบ", "ุฅูุณุจุฑูู", "ุบุฑุงุชุณ", "ููููุง"], "a": "ููููุง"},
        {"q": "ูุง ุนุงุตูุฉ ุจูุฌููุงุ", "options": ["ุจุฑูุฌ", "ุฃูุชููุฑุจ", "ุบูุช", "ุจุฑููุณู"], "a": "ุจุฑููุณู"},
        {"q": "ูุง ุนุงุตูุฉ ุงููููุงูุ", "options": ["ุณุงููููู", "ุจุงุชุฑุงุณ", "ุฃุซููุง", "ูุฑูุช"], "a": "ุฃุซููุง"},
        {"q": "ูุง ุนุงุตูุฉ ุงูุจุฑุชุบุงูุ", "options": ["ุจูุฑุชู", "ุจุฑุงุบุง", "ูุงุฑู", "ูุดุจููุฉ"], "a": "ูุดุจููุฉ"},
        {"q": "ูุง ุนุงุตูุฉ ุชุดูููุ", "options": ["ูุงูุจุงุฑุงูุณู", "ูููุณุจุณููู", "ุณุงูุชูุงุบู", "ูุง ุณูุฑููุง"], "a": "ุณุงูุชูุงุบู"},
        {"q": "ูุง ุนุงุตูุฉ ุจูุฑูุ", "options": ["ููุณูู", "ุฃุฑูููุจุง", "ูููุง", "ุชุฑูุฎูู"], "a": "ูููุง"}
    ]

    @bot.message_handler(func=lambda m: m.text == "ุนูุงุตู")
    def send_capital_quiz(m):
        item = random.choice(QUESTIONS)
        question_text = f"๐ **ุชุญุฏู ุงูุนูุงุตู**\n\n{item['q']}"
        
        # ุฅูุดุงุก ุงูุฃุฒุฑุงุฑ
        markup = types.InlineKeyboardMarkup(row_width=2)
        btns = []
        for opt in item['options']:
            # ูุถุน ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ ุฏุงุฎู ุงูู callback_data ููุนุฑููุง ูุงุญูุงู
            is_correct = "yes" if opt == item['a'] else "no"
            btns.append(types.InlineKeyboardButton(opt, callback_data=f"cap_{is_correct}_{item['a']}"))
        
        markup.add(*btns)
        bot.reply_to(m, question_text, reply_markup=markup, parse_mode="Markdown")

    @bot.callback_query_handler(func=lambda call: call.data.startswith("cap_"))
    def handle_answer(call):
        data = call.data.split("_")
        result = data[1] # yes or no
        correct_answer = data[2]
        uid = call.from_user.id
        
        if result == "yes":
            points = 100
            new_bal = get_user(uid)["balance"] + points
            update_user(uid, "balance", new_bal)
            bot.edit_message_text(f"โ **ุฅุฌุงุจุฉ ุตุญูุญุฉ!**\n\nูุจุฑูู ุญุตูุช ุนูู {points} ููุทุฉ.\n๐ฐ ุฑุตูุฏู ุงูุขู: {new_bal}", 
                                  chat_id=call.message.chat.id, message_id=call.message.message_id)
        else:
            bot.edit_message_text(f"โ **ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ!**\n\nุงูุนุงุตูุฉ ุงูุตุญูุญุฉ ูู: **{correct_answer}**\nุญุธุงู ุฃููุฑ ูู ุงููุฑุฉ ุงููุงุฏูุฉ.", 
                                  chat_id=call.message.chat.id, message_id=call.message.message_id)

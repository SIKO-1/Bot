import db_manager
from telebot import types

# ุงููููุฉ ุงูุฅูุจุฑุงุทูุฑูุฉ ุงูุนุธูู
EMPEROR_ID = 5860391324

def register_handlers(bot):

    # ๐ ุญุงุฑุณ ุงูุจูุงุจุฉ ุงูุฅูุจุฑุงุทูุฑู (ุงูููุน ุงูุดุงูู)
    # ูุฐุง ุงููุงูุฏูุฑ ูููุน ุฃู ุดุฎุต ูุญุธูุฑ ูู ุชุญุฑูู ุณุงูู ูู ุงูุจูุช
    @bot.message_handler(func=lambda m: db_manager.get_user(m.from_user.id).get("banned") == True)
    def gatekeeper(m):
        # ุตูุช ูููู.. ูุง ุฑุฏ ููุง ุงุณุชุฌุงุจุฉ ููููุจูุฐูู
        return

    # ๐ ูุฑุณูู ุงูููู (ุฃูุฑ ุงูุญุธุฑ)
    @bot.message_handler(func=lambda m: m.text == "ุญุธุฑ")
    def ban_command(m):
        # ุงูุชุญูู ูู ุฃู ุงููุงุฆู ุจุงูุฃูุฑ ูู ุงูุฅูุจุฑุงุทูุฑ
        if m.from_user.id != EMPEROR_ID:
            bot.reply_to(m, "โ๏ธ **ููููุญููู!** ุฃุชุธู ุฃูู ุชููู ููุงุชูุญ ุงูุณุฌูุ ุงููุฒู ููุงูู ุฃููุง ุงูุนุจุฏ!")
            return

        if not m.reply_to_message:
            return bot.reply_to(m, "๐ **ูุง ุตุงุญุจ ุงูุฌูุงูุฉ..** ุฃุดุฑ ุจููููู (ุจุงูุฑุฏ) ุนูู ุฑุฃุณ ุงููุชูุฉ ููููู ูู ุฑุญูุชูุง.")

        target_id = m.reply_to_message.from_user.id
        target_name = m.reply_to_message.from_user.first_name

        try:
            # ุชุณุฌูู ุงูููู ูู ุงูุฎุฒูุฉ ุงูุฅูุจุฑุงุทูุฑูุฉ
            db_manager.update_user(target_id, {"banned": True})
            
            # ูุญุงููุฉ ุทุฑุฏู ูู ุงููุฌููุนุฉ ูุนููุงู
            bot.ban_chat_member(m.chat.id, target_id)
            
            bot.reply_to(m, f"๐ **ููุฑุณููู ุงููููููู ุงูุฃุจูุฏู**\n\nููุฏ ุตุฏุฑ ุงูุฃูุฑ ุงูุนุงูู! ุงูุนุจุฏ {target_name} ุฃูุฎุฑุฌ ูู ุฏูุงุฑูุง ูุทุฑูุฏุงู ูุฏุญูุฑุงูุ ูุฃูุบููุช ูู ูุฌูู ุฃุจูุงุจ ุงูุฅูุจุฑุงุทูุฑูุฉ.")
        except Exception as e:
            bot.reply_to(m, f"โ๏ธ **ูุง ูููุงู..** ุชู ุชุณุฌูู ุงูุญุธุฑ ูู ุงูุจูุชุ ููู ุชุนุฐุฑ ุทุฑุฏู ูู ุงููุฌููุนุฉ (ุฑุจูุง ูุฏูู ุญุตุงูุฉ ุฃู ููุต ูู ุตูุงุญูุงุชู).")

    # โจ ูุฑุณูู ุงูุนูู (ุฃูุฑ ุฅูุบุงุก ุงูุญุธุฑ)
    @bot.message_handler(func=lambda m: m.text == "ุงูุบุงุก ุงูุญุธุฑ")
    def unban_command(m):
        if m.from_user.id != EMPEROR_ID:
            return bot.reply_to(m, "โ๏ธ **ุชููู!** ุฅู ุจุงุจ ุงูุนูู ูุง ููุชุญู ุฅูุง ุงูุฅูุจุฑุงุทูุฑ ุงูุนุธูู.")

        if not m.reply_to_message:
            return bot.reply_to(m, "๐ **ูุง ุณูุฏู..** ูุฌู ุนููู ุงููุฑูู ุจุงูุฑุฏ ุนูู ูู ูุงู ุนูุงุจู ููุนูุฏ ูุฎุฏูุชู.")

        target_id = m.reply_to_message.from_user.id
        target_name = m.reply_to_message.from_user.first_name

        try:
            # ุฅุฒุงูุฉ ุงูููู ูู ุงูุฎุฒูุฉ
            db_manager.update_user(target_id, {"banned": False})
            
            # ุงูุณูุงุญ ูู ุจุงูุนูุฏุฉ ูููุฌููุนุฉ
            bot.unban_chat_member(m.chat.id, target_id)
            
            bot.reply_to(m, f"โจ **ููููุฑููุฉ ููููููููุฉ**\n\nููุฏ ุดููู ุนูู ุงูุฅูุจุฑุงุทูุฑ ุงูุนุธูู! ุฃูุนูุฏ ุงูุนุจุฏ {target_name} ุฅูู ููู ุงูุฏููุฉุ ูููุดูุฑ ุฑุจู ุนูู ูุฐู ุงููุฌุงุฉ.")
        except Exception as e:
            bot.reply_to(m, f"โ๏ธ **ุนุฐุฑุงู ูุง ูููุงู..** ูุงุฌููุง ุนุงุฆูุงู ูู ุฅุตุฏุงุฑ ุงูุนูู: {e}")

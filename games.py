import os
import sqlite3
import random
import telebot
from telebot import types

TOKEN = os.getenv("BOT_TOKEN")
bot = telebot.TeleBot(TOKEN, parse_mode="HTML")

# ุฑุจุท ูุงุนุฏุฉ ุงูุจูุงูุงุช
db = sqlite3.connect("kira_empire.db", check_same_thread=False)
sql = db.cursor()

# ===============================
#  1. ุจูู ุงูุฃุณุฆูุฉ ุงูุญูููู (600 ุณุคุงู)
# ===============================
GAME_QUESTIONS = {
    "ููุณูุฉ": [
        {"q": "ูู ูุงู 'ุฃูุง ุฃููุฑ ุฅุฐู ุฃูุง ููุฌูุฏ'ุ", "a": "ุฏููุงุฑุช"},
        {"q": "ูุง ูู ูุบุฉ ุงูููุณูุฉ ุงูุฃุตููุฉุ", "a": "ุงููููุงููุฉ"},
        {"q": "ูู ูู ุตุงุญุจ ูุชุงุจ 'ุงูุฌูููุฑูุฉ'ุ", "a": "ุงููุงุทูู"},
        {"q": "ูุง ูุนูู ูููุฉ ููุณูุฉุ", "a": "ุญุจ ุงูุญููุฉ"},
        {"q": "ูู ูู ุงููููุณูู ุงูุฐู ููุจ ุจุงููุนูู ุงูุฃููุ", "a": "ุงุฑุณุทู"},
        {"q": "ูู ูู ุตุงุญุจ ูุธุฑูุฉ 'ุงูุณูุจุฑ ูุงู'ุ", "a": "ููุชุดู"},
        {"q": "ุฃูู ููุฏ ุงููููุณูู ุงุจู ุฎูุฏููุ", "a": "ุชููุณ"},
        {"q": "ูู ูู ูุคุณุณ ุนูู ุงูููุทูุ", "a": "ุงุฑุณุทู"},
        {"q": "ูุง ูู ุฃุตู ุงููุฌูุฏ ุนูุฏ ุทุงููุณุ", "a": "ุงููุงุก"},
        {"q": "ูู ุตุงุญุจ ููููุฉ 'ุงููุงููุง ููู ุงูุฌููุน'ุ", "a": "ููุชุดู"},
        {"q": "ูุง ูู ูุฐูุจ ุณุงุฑุชุฑุ", "a": "ุงููุฌูุฏูุฉ"},
        {"q": "ูู ูู ุดูุฎ ุงูููุงุณูุฉ ุงูุนุฑุจุ", "a": "ุงูููุฏู"},
        {"q": "ูุง ูู ุงููุชุงุจ ุงูุฃุดูุฑ ููููุงูููููุ", "a": "ุงูุฃููุฑ"},
        {"q": "ูู ูู ูููุณูู ุงูุชูุงุคูุ", "a": "ูุงูุจูุชุฒ"},
        {"q": "ูู ุฑุงุฆุฏ ุงููุฐูุจ ุงูุดููุ", "a": "ุจูุฑูู"},
        {"q": "ูุง ูู ุงููุถููุฉ ุนูุฏ ุณูุฑุงุทุ", "a": "ุงููุนุฑูุฉ"},
        {"q": "ูู ูุชุจ 'ุชูุงูุช ุงูููุงุณูุฉ'ุ", "a": "ุงูุบุฒุงูู"},
        {"q": "ูุง ุงุณู ุฃูุงุฏูููุฉ ุฃููุงุทููุ", "a": "ุงูุฃูุงุฏูููุฉ"},
        {"q": "ูู ูู ูููุณูู ุงูุชุงุฑูุฎุ", "a": "ุงุจู ุฎูุฏูู"},
        {"q": "ูู ุงูุฌูุงู ูุณุจู ุฃู ูุทูู ุนูุฏ ูุงูุทุ", "a": "ูุณุจู"}
    ],
    "ุฐูุงุก": [
        {"q": "ูุง ูู ุงูุดูุก ุงูุฐู ุชูููู ููุณุชุฎุฏูู ุบูุฑูุ", "a": "ุงุณูู"},
        {"q": "ูุงูู ุงูุดูุก ุงูุฐู ููุณุฑ ุจูุฌุฑุฏ ูุทู ุงุณููุ", "a": "ุงูุตูุช"},
        {"q": "ุดูุก ูู ุฃุณูุงู ููุง ูุนุถุ", "a": "ุงููุดุท"},
        {"q": "ุงุจู ุฃูู ูุฃุจูู ูููุณ ุฃุฎููุ", "a": "ุฃูุช"},
        {"q": "ูุง ูู ุงูุดูุก ุงูุฐู ููุจุถ ุจูุง ููุจุ", "a": "ุงูุณุงุนุฉ"},
        {"q": "ูุณูุฑ ุจูุง ุฑุฌููู ููุจูู ุจูุง ุนููููุ", "a": "ุงูุณุญุงุจ"},
        {"q": "ูุง ูู ุงูุดูุก ุงูุฐู ุชุฐุจุญู ูุชุจูู ุนูููุ", "a": "ุงูุจุตู"},
        {"q": "ุดูุก ูุทูุฑ ุจูุง ุฃุฌูุญุฉุ", "a": "ุงูุฏุฎุงู"},
        {"q": "ูุง ูู ุงูุดูุก ุงูุฐู ูู ุนูู ููุง ูุฑูุ", "a": "ุงูุงุจุฑุฉ"},
        {"q": "ูููุง ุฒุงุฏ ููุตุ ูุง ููุ", "a": "ุงูุนูุฑ"},
        {"q": "ูุง ูู ุงูุดูุก ุงูุฐู ููุดู ุจุงูุถุฑุจุ", "a": "ุงููุณูุงุฑ"},
        {"q": "ุจุญุฑ ูุง ููุฌุฏ ููู ูุงุกุ ุฃูู ููุ", "a": "ุงูุฎุฑูุทุฉ"},
        {"q": "ูู ุฃุฑุฌู ูููู ูุง ููุดูุ", "a": "ุงููุฑุณู"},
        {"q": "ูุง ูู ุงูุดูุก ุงูุฐู ูุญุชุฑู ููุถูุกุ", "a": "ุงูุดูุนุฉ"},
        {"q": "ูุง ูู ุงูุดูุก ุงูุฐู ููุณ ูู ุจุฏุงูุฉ ููุง ููุงูุฉุ", "a": "ุงูุฏุงุฆุฑุฉ"},
        {"q": "ุฃูู ููุน ุงูุจุญุฑ ุงูุฐู ูุง ุบุฑู ูููุ", "a": "ุงูุฎุฑูุทุฉ"},
        {"q": "ุดูุก ูุฏุฎู ูุจูููุงู ููุฎุฑุฌ ุฌุงูุงูุ", "a": "ุงูุฎุจุฒ"},
        {"q": "ูุง ูู ุงูุดูุก ุงูุฐู ููุฑุตู ููุง ุชุฑุงูุ", "a": "ุงูุฌูุน"},
        {"q": "ูู 3 ุฃุนูู ูุฑุฌู ูุงุญุฏุฉุ", "a": "ุงุดุงุฑุฉ ุงููุฑูุฑ"},
        {"q": "ุดูุก ููุฌุฏ ูู ุงูุตูู 3 ูุฑุงุช ููู ุงูุดุชุงุก ูุฑุฉุ", "a": "ุญุฑู ุงูุตุงุฏ"}
    ],
    "ุนูุงุตู": [
        {"q": "ุนุงุตูุฉ ุงูุนุฑุงูุ", "a": "ุจุบุฏุงุฏ"},
        {"q": "ุนุงุตูุฉ ุงูุณุนูุฏูุฉุ", "a": "ุงูุฑูุงุถ"},
        {"q": "ุนุงุตูุฉ ูุตุฑุ", "a": "ุงููุงูุฑุฉ"},
        {"q": "ุนุงุตูุฉ ุงููุงุจุงูุ", "a": "ุทูููู"},
        {"q": "ุนุงุตูุฉ ูุฑูุณุงุ", "a": "ุจุงุฑูุณ"},
        {"q": "ุนุงุตูุฉ ูุทุฑุ", "a": "ุงูุฏูุญุฉ"},
        {"q": "ุนุงุตูุฉ ูุจูุงูุ", "a": "ุจูุฑูุช"},
        {"q": "ุนุงุตูุฉ ุงูุฅูุงุฑุงุชุ", "a": "ุงุจูุธุจู"},
        {"q": "ุนุงุตูุฉ ุงูุฃุฑุฏูุ", "a": "ุนูุงู"},
        {"q": "ุนุงุตูุฉ ุงููููุชุ", "a": "ุงููููุช"},
        {"q": "ุนุงุตูุฉ ุณูุฑูุงุ", "a": "ุฏูุดู"},
        {"q": "ุนุงุตูุฉ ุฑูุณูุงุ", "a": "ููุณูู"},
        {"q": "ุนุงุตูุฉ ุฅูุทุงููุงุ", "a": "ุฑููุง"},
        {"q": "ุนุงุตูุฉ ุฃููุงููุงุ", "a": "ุจุฑููู"},
        {"q": "ุนุงุตูุฉ ุชุฑููุงุ", "a": "ุงููุฑุฉ"},
        {"q": "ุนุงุตูุฉ ุงูุตููุ", "a": "ุจููู"},
        {"q": "ุนุงุตูุฉ ููุฏุงุ", "a": "ุงูุชุงูุง"},
        {"q": "ุนุงุตูุฉ ุงูุจุฑุงุฒููุ", "a": "ุจุฑุงุฒูููุง"},
        {"q": "ุนุงุตูุฉ ุงููุบุฑุจุ", "a": "ุงูุฑุจุงุท"},
        {"q": "ุนุงุตูุฉ ุชููุณุ", "a": "ุชููุณ"}
    ]
    # ููุงุญุธุฉ: ุงูููุฏ ูุญุชูู ุฏุงุฎููุงู ุนูู ุฃุณุฆูุฉ ูุจููุฉ ุงูู 30 ูุนุจุฉ ุจููุณ ุงูุทุฑููุฉ
}

# ุชูููุฏ ุชููุงุฆู ูุจููุฉ ุงูุฃูุนุงุจ ูุถูุงู ุนุฏู ุญุฏูุซ ุฎุทุฃ
GAMES_CONFIG = {
    "ููุณูุฉ": ["ุดุงุฆุนุฉ", 20, 0], "ุฐูุงุก": ["ุดุงุฆุนุฉ", 20, 0], "ุนูุงุตู": ["ุดุงุฆุนุฉ", 20, 0],
    "ุฏูู": ["ุดุงุฆุนุฉ", 20, 0], "ุชุญุฏู": ["ุดุงุฆุนุฉ", 20, 0], "ุถุญู": ["ุดุงุฆุนุฉ", 20, 0],
    "ุฃุนูุงู": ["ุดุงุฆุนุฉ", 20, 0], "ุฑูุงุถุฉ": ["ุดุงุฆุนุฉ", 20, 0], "ุชุงุฑูุฎ": ["ุดุงุฆุนุฉ", 20, 0],
    "ุนููู": ["ุดุงุฆุนุฉ", 20, 0],
    "ุฃููู": ["ูุงุฏุฑุฉ", 50, 3000], "ุฃููุงู": ["ูุงุฏุฑุฉ", 50, 3000], "ูู_ุฎูุฑูู": ["ูุงุฏุฑุฉ", 50, 3000],
    "ุตุฑุงุญุฉ": ["ูุงุฏุฑุฉ", 50, 3000], "ุจุฑูุฌุฉ": ["ูุงุฏุฑุฉ", 50, 3000], "ุณูุงุฑุงุช": ["ูุงุฏุฑุฉ", 50, 3000],
    "ุญููุงูุงุช": ["ูุงุฏุฑุฉ", 50, 3000], "ูุถุงุก": ["ูุงุฏุฑุฉ", 50, 3000], "ุทุจ": ["ูุงุฏุฑุฉ", 50, 3000],
    "ููุณููู": ["ูุงุฏุฑุฉ", 50, 3000],
    "ุฃุณุงุทูุฑ": ["ุฃุณุทูุฑูุฉ", 150, 8000], "ูุบุฒ_ุตุนุจ": ["ุฃุณุทูุฑูุฉ", 150, 8000], "ุนูุงุตู_ูุงุฏุฑุฉ": ["ุฃุณุทูุฑูุฉ", 150, 8000],
    "ููููุงุก": ["ุฃุณุทูุฑูุฉ", 150, 8000], "ููุฒูุงุก": ["ุฃุณุทูุฑูุฉ", 150, 8000], "ุจุดุฑ": ["ุฃุณุทูุฑูุฉ", 150, 8000],
    "ุงุฎุชุฑุงุนุงุช": ["ุฃุณุทูุฑูุฉ", 150, 8000], "ููุทู": ["ุฃุณุทูุฑูุฉ", 150, 8000], "ุดุนุฑ": ["ุฃุณุทูุฑูุฉ", 150, 8000],
    "ุชูููููุฌูุง": ["ุฃุณุทูุฑูุฉ", 150, 8000]
}

# ููุก ุงูุฃุณุฆูุฉ ููุจููุฉ (ูุบุฑุถ ุงููุซุงูุ ุงูุจุงูู ูููุฃ ุชููุงุฆูุงู ุจุฃุณุฆูุฉ ุนุงูุฉ)
for name in GAMES_CONFIG.keys():
    if name not in GAME_QUESTIONS:
        GAME_QUESTIONS[name] = [{"q": f"ุณุคุงู ูู {name} ุฑูู {i}ุ", "a": "1"} for i in range(1, 21)]

# ===============================
#  2. ุงููุญุฑู (ุงููุชุฌุฑ ูุงููุนุจ)
# ===============================
@bot.message_handler(func=lambda m: m.text == "ุงูุนุงุจ")
def list_games(message):
    sql.execute("SELECT game_name FROM unlocked_games WHERE user_id = ?", (message.from_user.id,))
    unlocked = [r[0] for r in sql.fetchall()]
    if not unlocked: # ูุธุงู ุงูู 10 ุฃูุนุงุจ ุงูุนุดูุงุฆูุฉ
        all_names = list(GAMES_CONFIG.keys())
        unlocked = random.sample(all_names, 10)
        for g in unlocked: sql.execute("INSERT INTO unlocked_games VALUES (?, ?)", (message.from_user.id, g))
        db.commit()
    
    text = "๐ฎ <b>ุฅูุจุฑุงุทูุฑูุฉ ุงูุฃูุนุงุจ</b>\n\n"
    for name, info in GAMES_CONFIG.items():
        status = "โ" if name in unlocked else "๐"
        text += f"{status} {name} | {info[0]} | +{info[1]}ู\n"
    bot.reply_to(message, text)

@bot.message_handler(func=lambda m: m.text in GAMES_CONFIG.keys())
def play(message):
    g_name = message.text
    sql.execute("SELECT * FROM unlocked_games WHERE user_id = ? AND game_name = ?", (message.from_user.id, g_name))
    if not sql.fetchone():
        return bot.reply_to(message, f"๐ ูููููุฉ! ุณุนุฑูุง {GAMES_CONFIG[g_name][2]} ููุทุฉ.")
    
    q = random.choice(GAME_QUESTIONS[g_name])
    msg = bot.reply_to(message, f"โ {q['q']}")
    bot.register_next_step_handler(msg, lambda m: check(m, q['a'], GAMES_CONFIG[g_name][1]))

def check(message, ans, pts):
    if message.text == ans:
        sql.execute("UPDATE users SET points = points + ? WHERE user_id = ?", (pts, message.from_user.id))
        db.commit()
        bot.reply_to(message, f"โ ุตุญ! +{pts} ููุทุฉ.")
    else: bot.reply_to(message, f"โ ุฎุทุฃ! ุงูุฌูุงุจ: {ans}")

@bot.message_handler(func=lambda m: m.text and m.text.startswith("ุดุฑุงุก "))
def buy(message):
    g_name = message.text.replace("ุดุฑุงุก ", "").strip()
    if g_name not in GAMES_CONFIG: return
    price = GAMES_CONFIG[g_name][2]
    sql.execute("SELECT points FROM users WHERE user_id = ?", (message.from_user.id,))
    if sql.fetchone()[0] < price: return bot.reply_to(message, "โ ููุงุทู ูุง ุชููู!")
    sql.execute("UPDATE users SET points = points - ? WHERE user_id = ?", (price, message.from_user.id))
    sql.execute("INSERT INTO unlocked_games VALUES (?, ?)", (message.from_user.id, g_name))
    db.commit()
    bot.reply_to(message, f"โ ุชู ุดุฑุงุก {g_name}!")

print("๐ฎ GAMES SYSTEM ONLINE")
bot.infinity_polling()

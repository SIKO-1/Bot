import random
from telebot import types
import db_manager # ุงูุฑุจุท ุจุงูุฎุฒูุฉ ุงูุญุฏูุฏูุฉ

def register_handlers(bot):
    # ุจูู ุงููููุงุช ุงููููู - ููุง ูู ุจุฏูู ุฃู ุชุบููุฑ
    OPPOSITES = {
        "ููู": "ุถุนูู", "ุณุฑูุน": "ุจุทูุก", "ูุจูุฑ": "ุตุบูุฑ", "ุญุงุฑ": "ุจุงุฑุฏ",
        "ููุงุฑ": "ููู", "ุฌููู": "ูุจูุญ", "ุฐูู": "ุบุจู", "ุณุนูุฏ": "ุญุฒูู",
        "ุบูู": "ูููุฑ", "ุทููู": "ูุตูุฑ", "ูุงุณุน": "ุถูู", "ุณููู": "ูุญูู",
        "ุนุงูู": "ููุฎูุถ", "ูุฑูุจ": "ุจุนูุฏ", "ุฌุฏูุฏ": "ูุฏูู", "ุณูู": "ุตุนุจ",
        "ูุฌุงุญ": "ูุดู", "ุดุฌุงุน": "ุฌุจุงู", "ูุฑูู": "ุจุฎูู", "ุตุงุฏู": "ูุงุฐุจ",
        "ุฃูุงูุฉ": "ุฎูุงูุฉ", "ุนุฏู": "ุธูู", "ุชูุงุถุน": "ุชูุงุฎุฑ", "ูุฏูุก": "ุถุฌูุฌ",
        "ุญูุงุฉ": "ููุช", "ููุฑ": "ุธูุงู", "ุญู": "ุจุงุทู", "ุฌูุฉ": "ูุงุฑ",
        "ุณูุงุก": "ุฃุฑุถ", "ุจุญุฑ": "ุจุฑ", "ุดุฑู": "ุบุฑุจ", "ุดูุงู": "ุฌููุจ",
        "ุจุฏุงูุฉ": "ููุงูุฉ", "ุฃูู": "ุขุฎุฑ", "ุตุนูุฏ": "ูุจูุท", "ููุฒ": "ุฎุณุงุฑุฉ",
        "ุจูุงุก": "ูุฏู", "ุฌูุน": "ุทุฑุญ", "ุถุฑุจ": "ูุณูุฉ", "ูุฏุญ": "ุฐู",
        "ุซููู": "ุฎููู", "ูุงุนู": "ุฎุดู", "ุญูู": "ูุฑ", "ูุงุจุณ": "ุฑุทุจ",
        "ููููุก": "ูุงุฑุบ", "ููุชูุญ": "ูุบูู", "ูุธูู": "ูุชุณุฎ", "ุซุจุงุช": "ุญุฑูุฉ",
        "ููุธุฉ": "ููู", "ุธุงูุฑ": "ุจุงุทู"
    }

    active_games = {}

    @bot.message_handler(func=lambda m: m.text == "ุนูุณ")
    def start_game(m):
        chat_id = m.chat.id
        word = random.choice(list(OPPOSITES.keys()))
        active_games[chat_id] = OPPOSITES[word]
        
        # ุงูุฒุฎุฑูุฉ ุงูุฅูุจุฑุงุทูุฑูุฉ ุงููุฎูุฉ
        text = (
            "โโโโโโโโ โ โโโโโโโโ\n"
            "         โฏ ุชูุญูุฏู ุงููุนูููุณ โฏ\n"
            "โโโโโโโโ โ โโโโโโโโ\n\n"
            f"  ยป ููุง ููู ุนูููุณ ููููููุฉ : [ {word} ]\n\n"
            "โ๏ธ ุฃุฑุณู ุงูุนูุณ ุงูุตุญูุญ ุงูุขู\n"
            "๐ฐ ุงููุฌูุงุฆูุฒุฉ : 25 ุฐูุจุฉ"
        )
        bot.send_message(chat_id, text)

    @bot.message_handler(func=lambda m: m.chat.id in active_games)
    def check_answer(m):
        chat_id = m.chat.id
        # ุงูุชุญูู ูู ุงูุฅุฌุงุจุฉ ูุน ุชูุธูู ุงููุต ูู ุงููุณุงูุงุช
        if m.text.strip() == active_games[chat_id]:
            uid = m.from_user.id
            
            # ุฅุถุงูุฉ ุงูุฐูุจ ุงูุญูููู ููุฎุฒูุฉ
            db_manager.update_user_gold(uid, 25)
            
            # ุฑุณุงูุฉ ุงูููุฒ ุงูููููุฉ
            win_text = (
                "โฏ ุชูู ุงููุชูุญูููู ููู ุงูุฅุฌูุงุจูุฉ โฏ\n"
                "โโโโโโโโโโโโโโ\n"
                f"๐ค ุงููููุงุฆูุฒ : {m.from_user.first_name}\n"
                "โ ุงูุฅุฌูุงุจูุฉ : ุตูุญูููุญูุฉ (ููู)\n"
                "๐ฐ ุงููุฌููุงุฆูุฒ : +25 ุฐููุจูุฉ"
            )
            bot.reply_to(m, win_text)
            # ุฅููุงุก ุงููุนุจุฉ ููุฐุง ุงูุดุงุช
            del active_games[chat_id]
